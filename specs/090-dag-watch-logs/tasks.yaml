tasks:
    branch: "090-dag-watch-logs"
    created: "2026-01-11"
    spec_path: "specs/090-dag-watch-logs/spec.yaml"
    plan_path: "specs/090-dag-watch-logs/plan.yaml"
summary:
    total_tasks: 24
    total_phases: 8
    parallel_opportunities: 8
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Add fsnotify dependency and prepare log infrastructure"
      tasks:
        - id: "T001"
          title: "Add fsnotify dependency to go.mod"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "go.mod"
          dependencies: []
          acceptance_criteria:
            - "github.com/fsnotify/fsnotify v1.7+ added to go.mod"
            - "go mod tidy runs without errors"
    - number: 2
      title: "Foundational - Log Infrastructure"
      purpose: "Core log writing and tailing infrastructure used by multiple user stories"
      tasks:
        - id: "T002"
          title: "Implement TimestampedWriter in internal/dag/logwriter.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/dag/logwriter.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "TimestampedWriter struct wraps io.Writer"
            - "Prefixes each line with [HH:MM:SS] format"
            - "Thread-safe with sync.Mutex"
            - "Handles partial line writes correctly"
        - id: "T003"
          title: "Implement log truncation logic in internal/dag/logwriter.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/dag/logwriter.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "TruncateLog function removes oldest 20% when max size exceeded"
            - "Adds [TRUNCATED at HH:MM:SS] marker at beginning"
            - "Compatible with tail -f (preserves file descriptor)"
            - "Configurable max size via parameter"
        - id: "T004"
          title: "Add logwriter_test.go with map-based table tests"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: null
          file_path: "internal/dag/logwriter_test.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Tests for timestamp prefixing on single and multi-line writes"
            - "Tests for truncation at different file sizes"
            - "Tests for partial line buffering"
            - "Uses map[string]struct pattern with t.Run"
        - id: "T005"
          title: "Implement LogTailer with fsnotify in internal/dag/tailer.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/dag/tailer.go"
          dependencies: ["T002", "T003", "T004"]
          acceptance_criteria:
            - "LogTailer struct uses fsnotify for file watching"
            - "Tail method returns channel of new lines"
            - "Supports context cancellation for clean shutdown"
            - "Handles file not existing yet (waits for creation)"
            - "Continues streaming after truncation"
        - id: "T006"
          title: "Add tailer_test.go with map-based table tests"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/dag/tailer_test.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "Tests for streaming new lines as they're written"
            - "Tests for handling file creation after tailer starts"
            - "Tests for clean shutdown via context cancellation"
            - "Uses map[string]struct pattern"
    - number: 3
      title: "Foundational - Watch Infrastructure"
      purpose: "Core watch table rendering and keyboard input handling"
      tasks:
        - id: "T007"
          title: "Implement Watcher table renderer in internal/dag/watcher.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/dag/watcher.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Watcher struct manages terminal state and refresh loop"
            - "RenderTable outputs SPEC, STATUS, PROGRESS, DURATION, LAST UPDATE columns"
            - "Uses ANSI escape codes for cursor positioning"
            - "Clears previous table before redraw"
            - "Status column is color-coded (cyan=running, green=completed, red=failed)"
        - id: "T008"
          title: "Implement keyboard input handling in internal/dag/watcher.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/dag/watcher.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Uses golang.org/x/term for raw mode keyboard reading"
            - "Detects 'q' key press for clean exit"
            - "Handles Ctrl+C (SIGINT) for clean exit"
            - "Restores terminal state on exit"
        - id: "T009"
          title: "Add watcher_test.go with map-based table tests"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: null
          file_path: "internal/dag/watcher_test.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Tests for table rendering with various spec states"
            - "Tests for duration formatting"
            - "Tests for progress display formatting"
            - "Uses map[string]struct pattern"
    - number: 4
      title: "User Story 1 - Monitor active DAG run status (US-001)"
      purpose: "Real-time status visibility for developers running multi-spec workflows"
      story_reference: "US-001"
      independent_test: "Run a DAG with multiple specs, verify watch command displays all specs with correct status updates"
      tasks:
        - id: "T010"
          title: "Implement dag watch command in internal/cli/dag/watch.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/cli/dag/watch.go"
          dependencies: ["T007", "T008", "T009"]
          acceptance_criteria:
            - "Cobra command registered under dag subcommand"
            - "No args selects most recent active run"
            - "--interval flag configures refresh rate (default 2s)"
            - "Header shows 'Watching <run-id> (refresh: Xs, quit: q)'"
            - "Table refreshes at configured interval"
            - "Exit on 'q' key or Ctrl+C"
        - id: "T011"
          title: "Add helper to find latest active run in internal/dag/runstate.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-001"
          file_path: "internal/dag/runstate.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "FindLatestActiveRun function returns most recent running DAGRun"
            - "Returns nil with no error if no active runs"
            - "Sorted by StartedAt descending"
        - id: "T012"
          title: "Add watch_test.go with map-based table tests"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/cli/dag/watch_test.go"
          dependencies: ["T010", "T011"]
          acceptance_criteria:
            - "Tests for auto-selecting latest active run"
            - "Tests for --interval flag parsing"
            - "Tests for handling no active runs gracefully"
            - "Uses map[string]struct pattern"
    - number: 5
      title: "User Story 2 - View specific run by ID (US-002)"
      purpose: "Allow developers to monitor any run, not just the most recent"
      story_reference: "US-002"
      independent_test: "Start two runs, verify watch with explicit run-id shows the correct run"
      tasks:
        - id: "T013"
          title: "Add run-id argument handling to watch command"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/cli/dag/watch.go"
          dependencies: ["T010"]
          acceptance_criteria:
            - "Optional positional argument [run-id] accepted"
            - "Loads specific run state when run-id provided"
            - "Error message lists valid run-ids when invalid run-id provided"
            - "Suggests 'dag list' command to see available runs"
        - id: "T014"
          title: "Add tests for specific run-id handling"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-002"
          file_path: "internal/cli/dag/watch_test.go"
          dependencies: ["T013"]
          acceptance_criteria:
            - "Tests for watching specific run by ID"
            - "Tests for error when run-id not found"
            - "Uses map[string]struct pattern"
    - number: 6
      title: "User Stories 3 & 4 - Stream and view spec logs (US-003, US-004)"
      purpose: "Real-time log streaming for debugging and completed log review"
      story_reference: "US-003, US-004"
      independent_test: "Run a spec, use dag logs to stream output, verify lines appear as spec produces them; test --no-follow dumps and exits"
      tasks:
        - id: "T015"
          title: "Implement dag logs command in internal/cli/dag/logs.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/cli/dag/logs.go"
          dependencies: ["T005", "T006"]
          acceptance_criteria:
            - "Cobra command registered under dag subcommand"
            - "Required args: <run-id> <spec-id>"
            - "Prints 'Log: <path>' as first line"
            - "Streams log lines using LogTailer"
            - "Exits cleanly on Ctrl+C"
        - id: "T016"
          title: "Add --no-follow flag to logs command"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-004"
          file_path: "internal/cli/dag/logs.go"
          dependencies: ["T015"]
          acceptance_criteria:
            - "--no-follow flag dumps entire log and exits immediately"
            - "Exit code 0 on success"
            - "Handles empty log file gracefully"
        - id: "T017"
          title: "Add logs_test.go with map-based table tests"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-003"
          file_path: "internal/cli/dag/logs_test.go"
          dependencies: ["T015", "T016"]
          acceptance_criteria:
            - "Tests for log path display"
            - "Tests for --no-follow mode"
            - "Tests for error handling (missing run, missing spec)"
            - "Uses map[string]struct pattern"
    - number: 7
      title: "User Stories 5 & 6 - Latest run shortcut and enhanced list (US-005, US-006)"
      purpose: "Convenience features for quick access and run discovery"
      story_reference: "US-005, US-006"
      independent_test: "Create multiple runs, verify --latest selects most recent; verify list shows all runs with correct metadata"
      tasks:
        - id: "T018"
          title: "Add --latest flag to logs command"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-005"
          file_path: "internal/cli/dag/logs.go"
          dependencies: ["T015"]
          acceptance_criteria:
            - "--latest flag selects most recent run automatically"
            - "Error message if no runs exist"
            - "Works with any spec-id"
        - id: "T019"
          title: "Enhance dag list output format in internal/cli/dag/list.go"
          status: "Completed"
          type: "refactor"
          parallel: true
          story_id: "US-006"
          file_path: "internal/cli/dag/list.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Run-id as first column (already done, verify)"
            - "SPECS column shows completed/total count (e.g., '3/5')"
            - "STARTED column shows relative time (e.g., '5 min ago', 'yesterday')"
            - "Maintains color-coded status"
        - id: "T020"
          title: "Add tests for --latest flag and enhanced list"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-005"
          file_path: "internal/cli/dag/list_test.go"
          dependencies: ["T018", "T019"]
          acceptance_criteria:
            - "Tests for relative timestamp formatting"
            - "Tests for spec count formatting"
            - "Uses map[string]struct pattern"
    - number: 8
      title: "User Story 7 & Polish - Log size management and edge cases (US-007)"
      purpose: "Reliability features and production polish"
      story_reference: "US-007"
      independent_test: "Generate log output exceeding the limit, verify truncation with marker"
      tasks:
        - id: "T021"
          title: "Add dag.max_log_size config option"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-007"
          file_path: "internal/config/config.go"
          dependencies: ["T003"]
          acceptance_criteria:
            - "dag.max_log_size configurable in config.yml"
            - "Default value: 52428800 (50MB)"
            - "Validated as positive integer"
        - id: "T022"
          title: "Integrate truncation with CreateSpecOutput"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-007"
          file_path: "internal/dag/output.go"
          dependencies: ["T002", "T003", "T021"]
          acceptance_criteria:
            - "CreateSpecOutput uses TimestampedWriter"
            - "Periodic size check triggers truncation when exceeded"
            - "Truncation marker visible in log file"
        - id: "T023"
          title: "Add documentation for watch, logs, and list commands"
          status: "Completed"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "docs/public/dag-watch-logs.md"
          dependencies: ["T010", "T015", "T019"]
          acceptance_criteria:
            - "Usage examples for all three commands"
            - "Flag documentation for --interval, --no-follow, --latest"
            - "Log file path format documented"
            - "Configuration options documented"
        - id: "T024"
          title: "Run make test && make fmt && make lint && make build"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "Makefile"
          dependencies: ["T012", "T014", "T017", "T020", "T021", "T022", "T023"]
          acceptance_criteria:
            - "make test passes with all new tests"
            - "make fmt shows no changes needed"
            - "make lint passes without errors"
            - "make build produces working binary"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-002"]
        - story_id: "US-002"
          depends_on: ["US-001"]
          blocks: []
        - story_id: "US-003"
          depends_on: []
          blocks: ["US-004"]
        - story_id: "US-004"
          depends_on: ["US-003"]
          blocks: []
        - story_id: "US-005"
          depends_on: ["US-003"]
          blocks: []
        - story_id: "US-006"
          depends_on: []
          blocks: []
        - story_id: "US-007"
          depends_on: []
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2, 3]
        - phase: 2
          blocks: [4, 6]
        - phase: 3
          blocks: [4]
        - phase: 4
          blocks: [5]
        - phase: 5
          blocks: [8]
        - phase: 6
          blocks: [8]
        - phase: 7
          blocks: [8]
parallel_execution:
    - phase: 2
      parallel_groups:
        - tasks: ["T002", "T003", "T004"]
          rationale: "Independent implementations in same file, can be developed together"
    - phase: 3
      parallel_groups:
        - tasks: ["T007", "T008", "T009"]
          rationale: "Table rendering, keyboard input, and tests can be developed in parallel"
    - phase: 4
      parallel_groups:
        - tasks: ["T010", "T011"]
          rationale: "Command and helper function can be developed in parallel"
    - phase: 7
      parallel_groups:
        - tasks: ["T018", "T019"]
          rationale: "Different commands, no dependencies between them"
    - phase: 8
      parallel_groups:
        - tasks: ["T021", "T022", "T023"]
          rationale: "Config, integration, and docs can be developed independently"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3, 4]
        description: "Setup + Log Infrastructure + Watch Infrastructure + Basic Watch Command"
        validation: "dag watch shows live-updating table for most recent active run"
    incremental_delivery:
        - milestone: "Log Infrastructure Ready"
          phases: [1, 2]
          deliverable: "TimestampedWriter and LogTailer available for use"
        - milestone: "Watch Command MVP"
          phases: [1, 2, 3, 4]
          deliverable: "dag watch shows live status table with auto-refresh"
        - milestone: "Logs Command Complete"
          phases: [1, 2, 6]
          deliverable: "dag logs streams spec output in real-time"
        - milestone: "Full Feature Complete"
          phases: [1, 2, 3, 4, 5, 6, 7, 8]
          deliverable: "All commands working with edge cases handled and tests passing"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec 0.8.2"
    created: "2026-01-11T17:22:09Z"
    artifact_type: "tasks"
