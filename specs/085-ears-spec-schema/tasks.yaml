tasks:
    branch: "085-ears-spec-schema"
    created: "2026-01-06"
    spec_path: "specs/085-ears-spec-schema/spec.yaml"
    plan_path: "specs/085-ears-spec-schema/plan.yaml"
summary:
    total_tasks: 22
    total_phases: 7
    parallel_opportunities: 8
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Project initialization and new package structure"
      tasks:
        - id: "T001"
          title: "Create ears_validation.go skeleton file"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "internal/validation/ears_validation.go"
          dependencies: []
          acceptance_criteria:
            - "File exists with package declaration and placeholder functions"
            - "Contains ValidateEarsRequirements() stub"
            - "Contains pattern-specific helper stubs"
        - id: "T002"
          title: "Create ears_instructions.go skeleton file"
          status: "Completed"
          type: "setup"
          parallel: true
          story_id: null
          file_path: "internal/workflow/ears_instructions.go"
          dependencies: []
          acceptance_criteria:
            - "File exists with package declaration"
            - "Contains BuildEarsInstructions() stub"
            - "Contains InjectEarsInstructions() stub"
    - number: 2
      title: "Foundational"
      purpose: "Core infrastructure that MUST be complete before user stories"
      tasks:
        - id: "T003"
          title: "Add EarsRequirements *bool toggle to VerificationConfig"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/verification/config.go"
          dependencies: ["T001", "T002"]
          acceptance_criteria:
            - "EarsRequirements *bool field added to VerificationConfig struct"
            - "Field has yaml:'ears_requirements' and koanf:'ears_requirements' tags"
            - "FeatureEarsRequirements constant defined"
            - "IsEnabled() method updated with EARS case"
            - "levelPreset struct updated with EarsRequirements field"
            - "levelPresets map updated: basic=false, enhanced=true, full=true"
            - "GetEffectiveToggles() updated to include EARS"
        - id: "T004"
          title: "Add tests for EarsRequirements toggle"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/verification/config_test.go"
          dependencies: ["T003"]
          acceptance_criteria:
            - "Tests verify nil toggle inherits from level (basic=false, enhanced=true, full=true)"
            - "Tests verify explicit true/false overrides level default"
            - "Tests verify IsEnabled('ears_requirements') returns correct value"
            - "Map-based table-driven tests with t.Parallel()"
    - number: 3
      title: "User Story 1 - Enable EARS requirements in spec.yaml"
      purpose: "Add EARS requirements block to spec.yaml schema"
      story_reference: "US-001"
      independent_test: "Create a spec.yaml with ears_requirements block and validate it parses correctly"
      tasks:
        - id: "T005"
          title: "Add ears_requirements field to SpecSchema"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/validation/schema.go"
          dependencies: ["T003"]
          acceptance_criteria:
            - "ears_requirements SchemaField added to specSchemaFields"
            - "Field is optional (Required: false)"
            - "Field is array type with EarsRequirement child schema"
            - "Child schema includes: id, pattern, text, test_type, trigger, expected, state, condition, feature"
            - "pattern field has enum: ubiquitous, event-driven, state-driven, unwanted, optional"
            - "test_type field has enum: invariant, property, state-machine, exception, feature-flag"
        - id: "T006"
          title: "Add schema tests for ears_requirements"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/validation/artifact_spec_test.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "Tests verify ears_requirements is optional"
            - "Tests verify valid EARS requirement parses correctly"
            - "Tests verify pattern enum validation works"
            - "Tests verify test_type enum validation works"
            - "Map-based table-driven tests"
    - number: 4
      title: "User Story 2 - Configure EARS via verification level"
      purpose: "Enable EARS by default at enhanced/full verification levels"
      story_reference: "US-002"
      independent_test: "Set verification level to enhanced and confirm EARS is enabled without explicit toggle"
      tasks:
        - id: "T007"
          title: "Update config schema documentation for ears_requirements"
          status: "Completed"
          type: "documentation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/config/schema.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "ears_requirements added to KnownKeys map with description"
            - "Description mentions level-based defaults (basic=disabled, enhanced/full=enabled)"
        - id: "T008"
          title: "Add integration tests for EARS level-based defaults"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-002"
          file_path: "internal/verification/config_test.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Test verifies basic level disables EARS when toggle is nil"
            - "Test verifies enhanced level enables EARS when toggle is nil"
            - "Test verifies full level enables EARS when toggle is nil"
            - "Test verifies explicit ears_requirements: true at basic level enables EARS"
            - "Test verifies explicit ears_requirements: false at enhanced level disables EARS"
    - number: 5
      title: "User Story 3 - Pattern-specific EARS validation"
      purpose: "Validate EARS requirements with helpful error messages"
      story_reference: "US-003"
      independent_test: "Submit spec.yaml with invalid EARS pattern and verify error includes template example"
      tasks:
        - id: "T009"
          title: "Implement pattern-specific field validation"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/validation/ears_validation.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "ValidateEarsRequirements() validates pattern-specific required fields"
            - "Event-driven pattern requires trigger and expected fields"
            - "State-driven pattern requires state field"
            - "Unwanted pattern requires condition field"
            - "Optional pattern requires feature field"
            - "Ubiquitous pattern has no additional required fields"
        - id: "T010"
          title: "Implement EARS error messages with template examples"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/validation/ears_validation.go"
          dependencies: ["T009"]
          acceptance_criteria:
            - "Error messages include correct template for each pattern"
            - "Ubiquitous template: 'The [system] shall [action]'"
            - "Event-driven template: 'When [trigger], the [system] shall [action]'"
            - "State-driven template: 'While [state], the [system] shall [action]'"
            - "Unwanted template: 'If [condition], then the [system] shall [action]'"
            - "Optional template: 'Where [feature], the [system] shall [action]'"
        - id: "T011"
          title: "Implement cross-section ID uniqueness validation"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-003"
          file_path: "internal/validation/ears_validation.go"
          dependencies: ["T009"]
          acceptance_criteria:
            - "ValidateCrossSectionIDs() checks for ID conflicts"
            - "EARS IDs must be unique within ears_requirements section"
            - "EARS IDs must not conflict with functional requirement IDs"
            - "Error message lists all conflicting IDs"
        - id: "T012"
          title: "Add tests for EARS validation"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-003"
          file_path: "internal/validation/ears_validation_test.go"
          dependencies: ["T010", "T011"]
          acceptance_criteria:
            - "Tests for each pattern with valid requirements"
            - "Tests for each pattern missing required fields"
            - "Tests verify error messages include template"
            - "Tests for ID uniqueness within EARS section"
            - "Tests for ID conflicts across sections"
            - "Tests for unknown pattern value"
            - "Tests for empty ears_requirements array (valid)"
            - "Map-based table-driven tests with t.Parallel()"
    - number: 6
      title: "User Story 4 - Inject EARS guidance into specify command"
      purpose: "Dynamically inject EARS templates into specify command when enabled"
      story_reference: "US-004"
      independent_test: "Enable EARS, run specify command, verify injected instructions contain EARS templates"
      tasks:
        - id: "T013"
          title: "Implement BuildEarsInstructions() function"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-004"
          file_path: "internal/workflow/ears_instructions.go"
          dependencies: ["T003"]
          acceptance_criteria:
            - "Returns InjectableInstruction with Name='EarsRequirements'"
            - "Content includes all 5 EARS pattern templates"
            - "Content includes example for each pattern"
            - "Content includes test_type mapping for each pattern"
            - "Follows existing InjectableInstruction pattern from risk_assessment.go"
        - id: "T014"
          title: "Implement InjectEarsInstructions() function"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-004"
          file_path: "internal/workflow/ears_instructions.go"
          dependencies: ["T013"]
          acceptance_criteria:
            - "Function accepts command string and enabled bool"
            - "When enabled=true, appends EARS instruction block to command"
            - "When enabled=false, returns command unchanged"
            - "Uses BuildEarsInstructions() to get instruction content"
        - id: "T015"
          title: "Wire EARS injection into StageExecutor"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-004"
          file_path: "internal/workflow/stage_executor.go"
          dependencies: ["T014"]
          acceptance_criteria:
            - "ExecuteSpecify() checks VerificationConfig.IsEnabled('ears_requirements')"
            - "When enabled, calls InjectEarsInstructions() before execution"
            - "Injection happens after command template loading, before Claude execution"
        - id: "T016"
          title: "Add tests for EARS instruction injection"
          status: "InProgress"
          type: "test"
          parallel: false
          story_id: "US-004"
          file_path: "internal/workflow/ears_instructions_test.go"
          dependencies: ["T015"]
          acceptance_criteria:
            - "Tests verify BuildEarsInstructions() returns correct structure"
            - "Tests verify InjectEarsInstructions() appends when enabled"
            - "Tests verify InjectEarsInstructions() returns unchanged when disabled"
            - "Tests verify content includes all 5 pattern templates"
            - "Map-based table-driven tests with t.Parallel()"
    - number: 7
      title: "User Story 5 - Backwards compatibility for existing specs"
      purpose: "Ensure existing specs without ears_requirements continue working"
      story_reference: "US-005"
      independent_test: "Validate existing spec.yaml files in specs/ directory without ears_requirements block"
      tasks:
        - id: "T017"
          title: "Integrate EARS validation into spec validation pipeline"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-005"
          file_path: "internal/validation/artifact.go"
          dependencies: ["T012"]
          acceptance_criteria:
            - "ValidateSpec() calls ValidateEarsRequirements() when ears_requirements present AND feature enabled"
            - "Validation skipped when ears_requirements block is absent"
            - "Validation skipped when feature is disabled"
            - "Cross-section ID validation runs when both sections exist"
        - id: "T018"
          title: "Add backwards compatibility tests"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: "US-005"
          file_path: "internal/validation/artifact_spec_test.go"
          dependencies: ["T017"]
          acceptance_criteria:
            - "Tests validate spec.yaml without ears_requirements passes when EARS enabled"
            - "Tests validate spec.yaml without ears_requirements passes when EARS disabled"
            - "Tests validate against existing specs in specs/ directory"
            - "Tests verify no modifications required to existing specs"
        - id: "T019"
          title: "Add end-to-end test with EARS-enabled spec"
          status: "Pending"
          type: "test"
          parallel: true
          story_id: "US-005"
          file_path: "internal/validation/artifact_spec_test.go"
          dependencies: ["T017"]
          acceptance_criteria:
            - "Test creates spec.yaml with valid EARS requirements"
            - "Test validates spec passes validation"
            - "Test covers all 5 EARS patterns"
            - "Test verifies ID uniqueness validation"
    - number: 8
      title: "Polish & Cross-Cutting Concerns"
      purpose: "Documentation and final integration touches"
      tasks:
        - id: "T020"
          title: "Update YAML-STRUCTURED-OUTPUT.md with EARS schema"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "docs/internal/YAML-STRUCTURED-OUTPUT.md"
          dependencies: ["T017"]
          acceptance_criteria:
            - "EARS requirements schema documented in spec.yaml section"
            - "All 5 pattern templates documented with examples"
            - "Pattern-specific required fields documented"
            - "test_type mapping documented"
        - id: "T021"
          title: "Add EARS coverage to validation summary (optional)"
          status: "Pending"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/validation/artifact.go"
          dependencies: ["T017"]
          acceptance_criteria:
            - "Validation summary includes EARS requirements count"
            - "Summary shows pattern distribution (count per pattern type)"
            - "FR-011 requirement satisfied"
        - id: "T022"
          title: "Run full validation suite"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/validation/"
          dependencies: ["T018", "T019", "T020", "T021"]
          acceptance_criteria:
            - "All existing tests pass"
            - "All new tests pass"
            - "make lint passes"
            - "make build succeeds"
            - "Performance: <10ms per EARS requirement validation"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-003", "US-005"]
        - story_id: "US-002"
          depends_on: []
          blocks: []
        - story_id: "US-003"
          depends_on: ["US-001"]
          blocks: ["US-005"]
        - story_id: "US-004"
          depends_on: []
          blocks: []
        - story_id: "US-005"
          depends_on: ["US-001", "US-003"]
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3, 4, 5, 6]
        - phase: 3
          blocks: [5, 7]
        - phase: 4
          blocks: []
        - phase: 5
          blocks: [7]
        - phase: 6
          blocks: [7]
        - phase: 7
          blocks: [8]
parallel_execution:
    - phase: 1
      parallel_groups:
        - tasks: ["T001", "T002"]
          rationale: "Setup files in different packages (validation vs workflow)"
    - phase: 5
      parallel_groups:
        - tasks: ["T010", "T011"]
          rationale: "Error message implementation and ID validation are independent after T009"
    - phase: 7
      parallel_groups:
        - tasks: ["T018", "T019"]
          rationale: "Backwards compatibility and E2E tests are independent"
    - phase: 8
      parallel_groups:
        - tasks: ["T020", "T021"]
          rationale: "Documentation and coverage reporting are independent"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3, 5]
        description: "Setup + Foundational + Schema Extension + Validation = Working EARS validation"
        validation: "Run autospec artifact on spec.yaml with ears_requirements block"
    incremental_delivery:
        - milestone: "Foundation Ready"
          phases: [1, 2]
          deliverable: "EarsRequirements toggle in VerificationConfig with level-based defaults"
        - milestone: "Schema Complete"
          phases: [1, 2, 3]
          deliverable: "spec.yaml can include ears_requirements block"
        - milestone: "Validation Complete"
          phases: [1, 2, 3, 5]
          deliverable: "EARS requirements fully validated with pattern-specific rules"
        - milestone: "Injection Complete"
          phases: [1, 2, 3, 4, 5, 6]
          deliverable: "EARS templates injected into specify command when enabled"
        - milestone: "Full Feature"
          phases: [1, 2, 3, 4, 5, 6, 7, 8]
          deliverable: "Complete EARS support with backwards compatibility and documentation"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec 0.8.2"
    created: "2026-01-06T07:06:34Z"
    artifact_type: "tasks"
