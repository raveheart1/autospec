tasks:
    branch: "105-fix-agent-fetch-hang"
    created: "2026-01-27"
    spec_path: "specs/105-fix-agent-fetch-hang/spec.yaml"
    plan_path: "specs/105-fix-agent-fetch-hang/plan.yaml"
summary:
    total_tasks: 14
    total_phases: 5
    parallel_opportunities: 4
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Verify existing code structure and test infrastructure"
      tasks:
        - id: "T001"
          title: "Review existing isSSHURL function in internal/git/git.go"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "internal/git/git.go"
          dependencies: []
          acceptance_criteria:
            - "Understand current isSSHURL implementation"
            - "Identify where FetchAllRemotes and fetchRemote are defined"
            - "Confirm test file structure in internal/git/git_test.go"
    - number: 2
      title: "User Story 1 - Agent creates feature branches reliably"
      purpose: "Fix SSH hang by detecting SSH URLs and skipping fetch when SSH agent unavailable"
      story_reference: "US-001"
      independent_test: "Run autospec new-feature from within a Claude Code sandbox and verify completion"
      tasks:
        - id: "T002"
          title: "Write tests for extended isSSHURL function in internal/git/git_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/git/git_test.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Test covers git@ format (git@github.com:user/repo.git)"
            - "Test covers ssh:// format (ssh://git@github.com/user/repo.git)"
            - "Test covers git+ssh:// format (git+ssh://git@github.com/user/repo.git)"
            - "Test covers https:// format returning false"
            - "Test covers http:// format returning false"
            - "Uses map-based table test pattern (map[string]struct{})"
        - id: "T003"
          title: "Extend isSSHURL function to handle git+ssh:// scheme in internal/git/git.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/git/git.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "Function detects git@ prefix"
            - "Function detects ssh:// prefix"
            - "Function detects git+ssh:// prefix"
            - "Function returns false for https:// and http://"
            - "Function executes in under 1 microsecond"
            - "Function is under 40 lines"
        - id: "T004"
          title: "Write tests for isSSHAgentAvailable function in internal/git/git_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-001"
          file_path: "internal/git/git_test.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "Test case: SSH_AUTH_SOCK set and non-empty returns true"
            - "Test case: SSH_AUTH_SOCK not set returns false"
            - "Test case: SSH_AUTH_SOCK set to empty string returns false"
            - "Uses map-based table test pattern"
        - id: "T005"
          title: "Implement isSSHAgentAvailable function in internal/git/git.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/git/git.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "Function checks SSH_AUTH_SOCK environment variable"
            - "Returns true only if SSH_AUTH_SOCK is set and non-empty"
            - "Function is under 40 lines"
        - id: "T006"
          title: "Modify fetchRemote to skip SSH URLs when agent unavailable in internal/git/git.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/git/git.go"
          dependencies: ["T003", "T005"]
          acceptance_criteria:
            - "fetchRemote checks if URL is SSH before attempting fetch"
            - "If SSH URL and no SSH agent, skip fetch and log at debug level"
            - "HTTPS remotes are still fetched regardless of SSH agent status (FR-004)"
            - "Debug log includes remote name and reason for skip (FR-005)"
            - "Function is under 40 lines"
            - "Errors wrapped with context"
    - number: 3
      title: "User Story 2 - User can bypass fetch operations"
      purpose: "Add --no-fetch flag to new-feature command for explicit fetch bypass"
      story_reference: "US-002"
      independent_test: "Run autospec new-feature --no-fetch and verify no network calls are made"
      tasks:
        - id: "T007"
          title: "Write tests for --no-fetch flag behavior in internal/cli/new_feature_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-002"
          file_path: "internal/cli/new_feature_test.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Test verifies --no-fetch flag is parsed correctly"
            - "Test verifies fetch is skipped when --no-fetch is set"
            - "Test verifies fetch proceeds normally when --no-fetch is not set"
            - "Uses map-based table test pattern"
        - id: "T008"
          title: "Add --no-fetch flag to new-feature command in internal/cli/new_feature.go"
          status: "InProgress"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/cli/new_feature.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Flag is registered with Cobra command"
            - "Flag default is false (backwards compatible)"
            - "Flag is visible in --help output (FR-002)"
            - "When set, FetchAllRemotes is not called (FR-003)"
            - "Function modifications stay under 40 lines"
            - "Errors wrapped with context"
    - number: 4
      title: "User Story 3 - Fetch Timeout"
      purpose: "Implement configurable timeout on fetch operations to prevent indefinite hangs"
      story_reference: "US-003"
      independent_test: "Verify fetch operations timeout after 60 seconds and command continues"
      tasks:
        - id: "T009"
          title: "Write tests for FetchAllRemotesWithContext timeout behavior in internal/git/git_test.go"
          status: "Pending"
          type: "test"
          parallel: true
          story_id: "US-003"
          file_path: "internal/git/git_test.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Test verifies context cancellation stops fetch"
            - "Test verifies timeout error is handled gracefully"
            - "Test verifies warning is logged on timeout"
            - "Uses map-based table test pattern"
        - id: "T010"
          title: "Implement FetchAllRemotesWithContext with timeout in internal/git/git.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/git/git.go"
          dependencies: ["T009"]
          acceptance_criteria:
            - "Uses context.WithTimeout with 60 second default (FR-008)"
            - "Passes context to go-git fetch operations"
            - "Handles timeout errors gracefully with warning log"
            - "Does not hang indefinitely (NFR-001)"
            - "Function is under 40 lines"
            - "Errors wrapped with context"
        - id: "T011"
          title: "Update FetchAllRemotes to use context with default timeout in internal/git/git.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/git/git.go"
          dependencies: ["T010"]
          acceptance_criteria:
            - "FetchAllRemotes calls FetchAllRemotesWithContext with default timeout"
            - "Maintains backwards compatibility for callers"
            - "Function is under 40 lines"
    - number: 5
      title: "Polish & Documentation"
      purpose: "Verify all changes work together, add documentation and changelog"
      tasks:
        - id: "T012"
          title: "Run make test && make fmt && make lint && make build to verify all quality gates pass"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: null
          file_path: "Makefile"
          dependencies: ["T008", "T011"]
          acceptance_criteria:
            - "make test exits 0"
            - "make fmt exits 0"
            - "make lint exits 0"
            - "make build exits 0"
            - "All FR-009 criteria satisfied"
        - id: "T013"
          title: "Create manual testing plan in .dev/tasks/105-fix-agent-fetch-hang.md"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: ".dev/tasks/105-fix-agent-fetch-hang.md"
          dependencies: ["T012"]
          acceptance_criteria:
            - "Document manual test steps for sandbox environment"
            - "Include test for SSH remote skip behavior"
            - "Include test for --no-fetch flag"
            - "Include test for timeout behavior"
            - "Include Report Summaries section for results"
        - id: "T014"
          title: "Add changelog entry in internal/changelog/changelog.yaml and run make changelog-sync"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "internal/changelog/changelog.yaml"
          dependencies: ["T012"]
          acceptance_criteria:
            - "Add 1-3 user-facing bullets describing the fix"
            - "Run make changelog-sync to regenerate CHANGELOG.md"
            - "Changelog entry explains the hang fix for agent environments"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-002", "US-003"]
        - story_id: "US-002"
          depends_on: ["US-001"]
          blocks: []
        - story_id: "US-003"
          depends_on: ["US-001"]
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3, 4]
        - phase: 3
          blocks: [5]
        - phase: 4
          blocks: [5]
parallel_execution:
    - phase: 2
      parallel_groups:
        - tasks: ["T004"]
          rationale: "SSH agent test can be written in parallel with isSSHURL implementation"
    - phase: 4
      parallel_groups:
        - tasks: ["T009"]
          rationale: "Timeout tests can be written while US-002 implementation proceeds"
    - phase: 5
      parallel_groups:
        - tasks: ["T013", "T014"]
          rationale: "Manual testing plan and changelog can be created in parallel"
implementation_strategy:
    mvp_scope:
        phases: [1, 2]
        description: "Setup + US-001 (SSH detection and skip logic)"
        validation: "autospec new-feature completes in sandbox without hanging"
    incremental_delivery:
        - milestone: "Core Fix Complete"
          phases: [1, 2]
          deliverable: "Agents can create feature branches; SSH remotes skipped when no agent"
        - milestone: "Full Feature Complete"
          phases: [1, 2, 3, 4]
          deliverable: "--no-fetch flag available; timeout prevents all hang scenarios"
        - milestone: "Release Ready"
          phases: [1, 2, 3, 4, 5]
          deliverable: "All tests pass, documentation updated, changelog entry added"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec 0.10.1"
    created: "2026-01-27"
    artifact_type: "tasks"
