feature:
  branch: "079-init-path-argument"
  created: "2026-01-02"
  status: "Draft"
  input: "Add path argument to autospec init command to allow initializing projects at specified paths instead of only current working directory. Support relative paths, absolute paths, --here flag, and auto-create directories."

user_stories:
  - id: "US-001"
    title: "Initialize project at specified path"
    priority: "P1"
    as_a: "developer"
    i_want: "to run autospec init with a path argument"
    so_that: "I can initialize a project without first changing to that directory"
    why_this_priority: "Core functionality - without this the feature provides no value"
    independent_test: "Run init with a path and verify project structure is created at that location"
    acceptance_scenarios:
      - given: "a directory path that exists"
        when: "I run 'autospec init /path/to/project'"
        then: "autospec initializes the project at the specified path"
      - given: "a directory path that does not exist"
        when: "I run 'autospec init /path/to/new-project'"
        then: "autospec creates the directory and initializes the project there"
      - given: "a relative path"
        when: "I run 'autospec init my-project'"
        then: "autospec resolves the path relative to current directory and initializes there"

  - id: "US-002"
    title: "Initialize in current directory explicitly"
    priority: "P2"
    as_a: "developer"
    i_want: "to explicitly specify current directory with '.' or '--here'"
    so_that: "I can be explicit about my intention to initialize in the current directory"
    why_this_priority: "Enhances UX with explicit syntax but init without args already works"
    independent_test: "Run init with '.' or --here and verify behavior matches init without arguments"
    acceptance_scenarios:
      - given: "I am in a project directory"
        when: "I run 'autospec init .'"
        then: "autospec initializes in the current directory"
      - given: "I am in a project directory"
        when: "I run 'autospec init --here'"
        then: "autospec initializes in the current directory"

  - id: "US-003"
    title: "Constitution workflow runs in correct directory"
    priority: "P1"
    as_a: "developer"
    i_want: "the constitution workflow to run in the specified path"
    so_that: "the AI agent operates on the correct project directory"
    why_this_priority: "Without this, constitution would run in wrong directory causing failures"
    independent_test: "Run init with path and verify constitution subprocess uses correct working directory"
    acceptance_scenarios:
      - given: "I run init with a path argument"
        when: "the constitution workflow starts"
        then: "the workflow operates on files in the specified path, not the original working directory"

requirements:
  functional:
    - id: "FR-001"
      description: "MUST accept an optional path argument as the first positional argument"
      testable: true
      acceptance_criteria: "Command signature is 'init [path]' and accepts 0 or 1 arguments"
    - id: "FR-002"
      description: "MUST resolve relative paths relative to the current working directory"
      testable: true
      acceptance_criteria: "'init my-project' creates ./my-project when run from current directory"
    - id: "FR-003"
      description: "MUST accept absolute paths"
      testable: true
      acceptance_criteria: "'init /home/user/project' initializes at that exact location"
    - id: "FR-004"
      description: "MUST create the target directory if it does not exist"
      testable: true
      acceptance_criteria: "Non-existent path is created with 0755 permissions before initialization"
    - id: "FR-005"
      description: "MUST treat '.' as equivalent to no argument (current directory)"
      testable: true
      acceptance_criteria: "'init .' and 'init' produce identical results"
    - id: "FR-006"
      description: "MUST provide '--here' flag as alias for current directory"
      testable: true
      acceptance_criteria: "'init --here' behaves identically to 'init .'"
    - id: "FR-007"
      description: "MUST fail with clear error if path exists but is a file"
      testable: true
      acceptance_criteria: "Error message states 'path exists and is not a directory'"
    - id: "FR-008"
      description: "MUST ensure all subprocesses (constitution, worktree) run in the specified path"
      testable: true
      acceptance_criteria: "Claude subprocess working directory is the specified path"
    - id: "FR-009"
      description: "MUST create project config at <path>/.autospec/config.yml when --project flag is used with path"
      testable: true
      acceptance_criteria: "'init /path --project' creates /path/.autospec/config.yml"

  non_functional:
    - id: "NFR-001"
      category: "usability"
      description: "Command behavior should be intuitive and consistent with standard CLI conventions"
      measurable_target: "Users familiar with git init <path> should find behavior predictable"
    - id: "NFR-002"
      category: "reliability"
      description: "Path operations must handle edge cases gracefully"
      measurable_target: "All edge cases documented in spec produce defined behavior without panic"

success_criteria:
  measurable_outcomes:
    - id: "SC-001"
      description: "Users can initialize projects at any accessible filesystem location without changing directories"
      metric: "All path variants (relative, absolute, dot, --here) successfully initialize projects"
      target: "100% of documented path formats work correctly"
    - id: "SC-002"
      description: "Existing behavior is preserved for users who run init without arguments"
      metric: "Backward compatibility with current init command"
      target: "Zero breaking changes for 'autospec init' without arguments"
    - id: "SC-003"
      description: "Constitution workflow operates on the correct project regardless of path argument"
      metric: "Files created/modified by constitution appear in specified path"
      target: "100% of init operations with path result in correct file locations"

key_entities:
  - name: "InitPath"
    description: "The target directory path for initialization"
    attributes:
      - "Can be relative or absolute"
      - "Created automatically if non-existent"
      - "Must be a directory, not a file"
  - name: "WorkingDirectory"
    description: "The effective directory for subprocess execution"
    attributes:
      - "Set to InitPath before running constitution"
      - "Affects where Claude subprocess operates"

edge_cases:
  - scenario: "Path argument is a file, not a directory"
    expected_behavior: "Return error: 'path exists and is not a directory'"
  - scenario: "Path exists and is not empty"
    expected_behavior: "Proceed with initialization (matches current behavior for cwd)"
  - scenario: "Path contains spaces or special characters"
    expected_behavior: "Handle correctly via proper shell quoting"
  - scenario: "Both path argument and --here flag provided"
    expected_behavior: "Path argument takes precedence over --here flag"
  - scenario: "Path is '~' or contains '~'"
    expected_behavior: "Expand tilde to user home directory"
  - scenario: "Insufficient permissions to create directory"
    expected_behavior: "Return clear error about permission denied"
  - scenario: "Path argument combined with --project flag"
    expected_behavior: "Create project config at <path>/.autospec/config.yml"

assumptions:
  - "Users have permission to create directories at specified paths"
  - "The operating system supports standard POSIX path conventions (or Windows equivalents)"
  - "Tilde expansion follows standard shell conventions"
  - "Current init behavior (no arguments) is the baseline that must be preserved"

constraints:
  - "Must maintain backward compatibility with existing 'autospec init' usage"
  - "Must work across supported operating systems (Linux, macOS, Windows)"
  - "Path resolution must complete before any initialization operations begin"

out_of_scope:
  - "--no-git flag (autospec doesn't init git repos)"
  - "--force flag behavior changes (already exists for overwriting)"
  - "--skip-tls flag (not applicable to autospec)"
  - "--github-token flag (no template download functionality)"
  - "Remote path support (SSH, HTTP URLs)"
  - "Symbolic link special handling beyond OS defaults"

_meta:
  version: "1.0.0"
  generator: "autospec"
  generator_version: "autospec v0.7.3"
  created: "2026-01-02T19:26:30Z"
  artifact_type: "spec"
