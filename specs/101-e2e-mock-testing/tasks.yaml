tasks:
    branch: "101-e2e-mock-testing"
    created: "2026-01-16"
    spec_path: "specs/101-e2e-mock-testing/spec.yaml"
    plan_path: "specs/101-e2e-mock-testing/plan.yaml"
summary:
    total_tasks: 18
    total_phases: 6
    parallel_opportunities: 8
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Project initialization and E2E test directory structure"
      tasks:
        - id: "T001"
          title: "Create tests/e2e/ directory structure"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "tests/e2e/"
          dependencies: []
          acceptance_criteria:
            - "tests/e2e/ directory exists"
            - "Directory is ready for test files with //go:build e2e tag"
    - number: 2
      title: "Foundational"
      purpose: "Core infrastructure that MUST be complete before user stories"
      tasks:
        - id: "T002"
          title: "Create E2EEnv helper struct in internal/testutil/e2e.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/testutil/e2e.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "E2EEnv struct defined with tempDir, binDir, specsDir, originalPath, originalEnv fields"
            - "Setup function creates isolated temp directory"
            - "PATH isolation adds only mock and autospec binaries"
            - "Environment sanitization removes ANTHROPIC_API_KEY"
            - "Cleanup function restores original PATH and environment"
            - "Functions under 40 lines"
        - id: "T003"
          title: "Create CommandResult struct and Run method in internal/testutil/e2e.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/testutil/e2e.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "CommandResult struct with ExitCode, Stdout, Stderr, Duration fields"
            - "Run method executes autospec commands in isolated environment"
            - "Command output captured correctly"
            - "Duration tracked for performance validation"
        - id: "T004"
          title: "Create response fixtures in testdata/e2e/responses/"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "testdata/e2e/responses/"
          dependencies: ["T001"]
          acceptance_criteria:
            - "testdata/e2e/responses/spec.yaml with valid spec structure"
            - "testdata/e2e/responses/plan.yaml with valid plan structure"
            - "testdata/e2e/responses/tasks.yaml with valid task phases"
            - "testdata/e2e/responses/constitution.yaml with valid constitution"
            - "testdata/e2e/responses/implement.txt with success message"
            - "All fixtures pass autospec artifact validation"
        - id: "T005"
          title: "Enhance mock-claude.sh to support E2E test fixtures"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "mocks/scripts/mock-claude.sh"
          dependencies: ["T001", "T004"]
          acceptance_criteria:
            - "Mock script detects stage from prompt content (specify, plan, tasks, implement, constitution)"
            - "Returns appropriate YAML from testdata/e2e/responses/ fixtures"
            - "Supports configurable exit codes for error simulation via MOCK_CLAUDE_EXIT_CODE env var"
            - "Returns generic success for unrecognized prompts"
    - number: 3
      title: "User Story 1 - Developer runs E2E tests safely"
      purpose: "Enable safe E2E testing without real API calls"
      story_reference: "US-001"
      independent_test: "Run go test -tags=e2e and verify mock claude is invoked instead of real claude"
      tasks:
        - id: "T006"
          title: "Create base E2E test file with build tag in tests/e2e/e2e_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "tests/e2e/e2e_test.go"
          dependencies: ["T003", "T005"]
          acceptance_criteria:
            - "File has //go:build e2e build tag"
            - "TestE2E_MockClaudeInvoked verifies mock is called instead of real claude"
            - "TestE2E_NoAPIKeyInEnvironment verifies ANTHROPIC_API_KEY is absent"
            - "Tests use map-based table test pattern"
            - "All tests pass with go test -tags=e2e ./tests/e2e/..."
        - id: "T007"
          title: "Verify E2E tests are excluded from normal test runs"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "tests/e2e/e2e_test.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Running go test ./... does NOT execute E2E tests"
            - "Running go test -tags=e2e ./tests/e2e/... DOES execute E2E tests"
            - "Build tag isolation confirmed"
    - number: 4
      title: "User Story 2 - Developer tests individual stages"
      purpose: "Test each workflow stage independently"
      story_reference: "US-002"
      independent_test: "Run TestE2E_Specify and verify spec.yaml is created with valid structure"
      tasks:
        - id: "T008"
          title: "Implement TestE2E_Specify in tests/e2e/stage_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-002"
          file_path: "tests/e2e/stage_test.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "File has //go:build e2e build tag"
            - "Test sets up E2EEnv with mock claude"
            - "Test runs autospec specify with feature description"
            - "Test verifies spec.yaml is created with valid structure"
            - "Uses map-based table test pattern"
        - id: "T009"
          title: "Implement TestE2E_Plan in tests/e2e/stage_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-002"
          file_path: "tests/e2e/stage_test.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Test sets up E2EEnv with spec.yaml prerequisite"
            - "Test runs autospec plan"
            - "Test verifies plan.yaml is created with valid structure"
            - "Uses map-based table test pattern"
        - id: "T010"
          title: "Implement TestE2E_Tasks in tests/e2e/stage_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-002"
          file_path: "tests/e2e/stage_test.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Test sets up E2EEnv with plan.yaml prerequisite"
            - "Test runs autospec tasks"
            - "Test verifies tasks.yaml is created with valid phases"
            - "Uses map-based table test pattern"
        - id: "T011"
          title: "Implement TestE2E_Implement in tests/e2e/stage_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-002"
          file_path: "tests/e2e/stage_test.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Test sets up E2EEnv with tasks.yaml prerequisite"
            - "Test runs autospec implement"
            - "Test verifies implementation completes successfully"
            - "Uses map-based table test pattern"
    - number: 5
      title: "User Story 3 - Developer tests full workflows"
      purpose: "Test multi-stage orchestration end-to-end"
      story_reference: "US-003"
      independent_test: "Run TestE2E_PrepWorkflow and verify all three artifacts are created in sequence"
      tasks:
        - id: "T012"
          title: "Implement TestE2E_PrepWorkflow in tests/e2e/workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-003"
          file_path: "tests/e2e/workflow_test.go"
          dependencies: ["T008", "T009", "T010"]
          acceptance_criteria:
            - "File has //go:build e2e build tag"
            - "Test sets up E2EEnv with constitution"
            - "Test runs autospec prep with feature description"
            - "Test verifies spec.yaml, plan.yaml, and tasks.yaml are all created"
            - "Uses map-based table test pattern"
        - id: "T013"
          title: "Implement TestE2E_FullWorkflow in tests/e2e/workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-003"
          file_path: "tests/e2e/workflow_test.go"
          dependencies: ["T011", "T012"]
          acceptance_criteria:
            - "Test sets up E2EEnv with constitution"
            - "Test runs autospec run -a with feature description"
            - "Test verifies all artifacts created and implementation completes"
            - "Uses map-based table test pattern"
    - number: 6
      title: "User Story 4 - Developer tests error handling"
      purpose: "Verify graceful failure with appropriate error messages"
      story_reference: "US-004"
      independent_test: "Run TestE2E_MissingConstitution and verify error message and non-zero exit"
      tasks:
        - id: "T014"
          title: "Implement TestE2E_MissingConstitution in tests/e2e/error_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-004"
          file_path: "tests/e2e/error_test.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "File has //go:build e2e build tag"
            - "Test sets up E2EEnv WITHOUT constitution"
            - "Test runs workflow stage command"
            - "Test verifies error message about missing constitution"
            - "Test verifies non-zero exit code"
            - "Uses map-based table test pattern"
        - id: "T015"
          title: "Implement TestE2E_MissingPrereq in tests/e2e/error_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-004"
          file_path: "tests/e2e/error_test.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Test runs autospec implement without tasks.yaml"
            - "Test verifies error about missing prerequisite"
            - "Test verifies non-zero exit code"
            - "Uses map-based table test pattern"
        - id: "T016"
          title: "Implement TestE2E_MockFailure in tests/e2e/error_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-004"
          file_path: "tests/e2e/error_test.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Test configures mock claude to return exit code 1 via MOCK_CLAUDE_EXIT_CODE"
            - "Test runs autospec stage command"
            - "Test verifies error is propagated correctly"
            - "Test verifies appropriate exit code"
            - "Uses map-based table test pattern"
    - number: 7
      title: "Polish & Cross-Cutting Concerns"
      purpose: "Documentation updates and final validation"
      tasks:
        - id: "T017"
          title: "Update mocks/README.md with E2E test documentation"
          status: "Completed"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "mocks/README.md"
          dependencies: ["T013", "T014", "T015", "T016"]
          acceptance_criteria:
            - "Document E2E test purpose and usage"
            - "Document how to run E2E tests with go test -tags=e2e"
            - "Document response fixture locations and format"
            - "Document mock claude configuration options"
        - id: "T018"
          title: "Run make test && make fmt && make lint && make build"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "Makefile"
          dependencies: ["T017"]
          acceptance_criteria:
            - "make test passes (unit tests)"
            - "make fmt passes (code formatting)"
            - "make lint passes (linter checks)"
            - "make build passes (binary builds)"
            - "go test -tags=e2e ./tests/e2e/... passes (E2E tests)"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-002", "US-003", "US-004"]
        - story_id: "US-002"
          depends_on: ["US-001"]
          blocks: ["US-003"]
        - story_id: "US-003"
          depends_on: ["US-002"]
          blocks: []
        - story_id: "US-004"
          depends_on: ["US-001"]
          blocks: []
        - story_id: "US-005"
          depends_on: []
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3, 4, 5, 6]
        - phase: 3
          blocks: [4]
        - phase: 4
          blocks: [5]
        - phase: 5
          blocks: [7]
        - phase: 6
          blocks: [7]
parallel_execution:
    - phase: 2
      parallel_groups:
        - tasks: ["T004", "T005"]
          rationale: "Fixtures and mock enhancement can be developed in parallel"
    - phase: 4
      parallel_groups:
        - tasks: ["T008", "T009", "T010", "T011"]
          rationale: "Individual stage tests are independent of each other"
    - phase: 5
      parallel_groups:
        - tasks: ["T012", "T013"]
          rationale: "Workflow tests can be developed in parallel after stage tests"
    - phase: 6
      parallel_groups:
        - tasks: ["T014", "T015", "T016"]
          rationale: "Error handling tests are independent of each other"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3]
        description: "Setup + Foundational + Developer runs E2E tests safely"
        validation: "Run go test -tags=e2e ./tests/e2e/... and verify mock is used instead of real claude"
    incremental_delivery:
        - milestone: "Foundation Ready"
          phases: [1, 2]
          deliverable: "E2EEnv helper and mock infrastructure available for test development"
        - milestone: "Safe E2E Testing"
          phases: [1, 2, 3]
          deliverable: "Developers can run E2E tests with guaranteed mock isolation"
        - milestone: "Stage Coverage"
          phases: [1, 2, 3, 4]
          deliverable: "All individual stages (specify, plan, tasks, implement) have E2E tests"
        - milestone: "Workflow Coverage"
          phases: [1, 2, 3, 4, 5]
          deliverable: "Multi-stage workflows (prep, run) have E2E tests"
        - milestone: "Full Coverage"
          phases: [1, 2, 3, 4, 5, 6, 7]
          deliverable: "Complete E2E test suite with error handling and documentation"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec 0.9.0"
    created: "2026-01-16T10:19:52Z"
    artifact_type: "tasks"
