tasks:
    branch: "093-dag-name-branches"
    created: "2026-01-11"
    spec_path: "specs/093-dag-name-branches/spec.yaml"
    plan_path: "specs/093-dag-name-branches/plan.yaml"
summary:
    total_tasks: 18
    total_phases: 7
    parallel_opportunities: 6
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Create new slug.go file and test scaffolding"
      tasks:
        - id: "T001"
          title: "Create internal/dag/slug.go with Slugify function"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/dag/slug.go"
          dependencies: []
          acceptance_criteria:
            - "Slugify function lowercases input"
            - "Replaces whitespace with hyphens"
            - "Removes non-alphanumeric characters except hyphens"
            - "Collapses multiple consecutive hyphens"
            - "Trims leading/trailing hyphens"
            - "Truncates to 50 characters maximum"
            - "Function is under 40 lines"
        - id: "T002"
          title: "Create internal/dag/slug_test.go with table-driven tests"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/dag/slug_test.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Uses map[string]struct{} table test pattern"
            - "Tests: 'GitStats CLI v1' -> 'gitstats-cli-v1'"
            - "Tests: 'Feature: Auth & Sessions' -> 'feature-auth-sessions'"
            - "Tests: '  My  DAG  ' -> 'my-dag'"
            - "Tests: empty string edge case"
            - "Tests: special characters only input"
            - "Tests: truncation at 50 chars"
            - "Tests: unicode characters"
    - number: 2
      title: "Foundational - Type Extensions"
      purpose: "Extend DAGMetadata and DAGRun structs for ID tracking"
      tasks:
        - id: "T003"
          title: "Add ID field to DAGMetadata in internal/dag/types.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/dag/types.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "DAGMetadata has optional ID string field with yaml tag 'id,omitempty'"
            - "ID field is documented with godoc comment"
        - id: "T004"
          title: "Add DAGId and DAGName fields to DAGRun in internal/dag/runstate.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/dag/runstate.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "DAGRun has DAGId string field with yaml tag 'dag_id'"
            - "DAGRun has DAGName string field with yaml tag 'dag_name'"
            - "Fields are documented with godoc comments"
        - id: "T005"
          title: "Add ResolveDAGID function to internal/dag/slug.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/dag/slug.go"
          dependencies: ["T003", "T004"]
          acceptance_criteria:
            - "Returns dag.ID if set"
            - "Returns Slugify(dag.Name) if ID not set but Name is"
            - "Returns slugified workflow filename if neither ID nor Name is set"
            - "Function is under 40 lines"
            - "Errors wrapped with context"
        - id: "T006"
          title: "Add ResolveDAGID tests to internal/dag/slug_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/dag/slug_test.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "Tests explicit dag.id override"
            - "Tests slugified dag.name when no id"
            - "Tests workflow filename fallback"
            - "Tests priority: id > name > filename"
            - "Uses map[string]struct{} table test pattern"
    - number: 3
      title: "User Story 1 - Self-documenting branch names (US-001)"
      purpose: "Generate human-readable branch names from DAG name slug"
      story_reference: "US-001"
      independent_test: "Run a DAG and verify branch names contain the DAG name slug"
      tasks:
        - id: "T007"
          title: "Update createWorktree() in internal/dag/executor.go to use dag/<dag-id>/<spec-id> format"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/dag/executor.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Branch names use format dag/<dag-id>/<spec-id>"
            - "Worktree directory uses format dag-<dag-id>-<spec-id>"
            - "DAG ID is resolved using ResolveDAGID function"
            - "Existing runBranchName/worktreeName helpers updated or replaced"
        - id: "T008"
          title: "Store branch name in SpecState for resume idempotency"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/dag/runstate.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "SpecState has Branch string field stored in state file"
            - "Resume reads branch from state rather than regenerating"
            - "New runs store branch at worktree creation time"
        - id: "T009"
          title: "Add executor_test.go tests for new branch naming"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/dag/executor_test.go"
          dependencies: ["T008"]
          acceptance_criteria:
            - "Tests branch format dag/<dag-id>/<spec-id>"
            - "Tests worktree directory format dag-<dag-id>-<spec-id>"
            - "Tests with explicit dag.id"
            - "Tests with slugified dag.name"
            - "Tests with workflow filename fallback"
    - number: 4
      title: "User Story 3 - Resume existing DAG run (US-003) and User Story 4 - Detect DAG ID changes (US-004)"
      purpose: "Ensure resume uses stored branches and detect ID mismatches"
      story_reference: "US-003, US-004"
      independent_test: "Stop a DAG run, restart it, verify existing branches are reused; change dag.name after first run, verify error"
      tasks:
        - id: "T010"
          title: "Update NewDAGRun to accept DAG config for ID resolution"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/dag/runstate.go"
          dependencies: ["T009"]
          acceptance_criteria:
            - "NewDAGRun stores resolved dag_id and dag_name at creation"
            - "ID is immutable once state file exists"
            - "Resume reuses stored branch/worktree paths from state"
        - id: "T011"
          title: "Add ID mismatch detection in internal/cli/dag/run.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-004"
          file_path: "internal/cli/dag/run.go"
          dependencies: ["T010"]
          acceptance_criteria:
            - "Compare resolved ID with stored ID before execution"
            - "Error with clear message when mismatch detected"
            - "Error includes remediation options: revert YAML or use --fresh"
            - "NFR-005 satisfied: actionable guidance in error"
        - id: "T012"
          title: "Add tests for ID mismatch detection scenarios"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-004"
          file_path: "internal/dag/runstate_test.go"
          dependencies: ["T011"]
          acceptance_criteria:
            - "Tests mismatch when dag.name changes"
            - "Tests mismatch when dag.id changes"
            - "Tests no error when dag.name changes but dag.id is set"
            - "Tests no error when resolved ID matches"
            - "Uses map[string]struct{} table test pattern"
    - number: 5
      title: "User Story 2 - Override with explicit ID (US-002) and User Story 5 - Handle collisions (US-005)"
      purpose: "Support explicit ID override and handle branch name collisions"
      story_reference: "US-002, US-005"
      independent_test: "Set dag.id in YAML and verify it's used; create two DAGs with same resolved ID, verify collision handling"
      tasks:
        - id: "T013"
          title: "Implement collision detection and hash suffix fallback in internal/dag/executor.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-005"
          file_path: "internal/dag/executor.go"
          dependencies: ["T012"]
          acceptance_criteria:
            - "Check for existing branch with different DAG before creation"
            - "Append 4-character hash suffix on collision"
            - "Hash suffix ensures uniqueness while maintaining readability"
            - "Function under 40 lines"
        - id: "T014"
          title: "Add tests for collision handling scenarios"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: "US-005"
          file_path: "internal/dag/executor_test.go"
          dependencies: ["T013"]
          acceptance_criteria:
            - "Tests collision detection with existing branch"
            - "Tests hash suffix generation"
            - "Tests uniqueness of suffixed branches"
            - "Uses map[string]struct{} table test pattern"
    - number: 6
      title: "User Story 6 - Validate DAG uniqueness (US-006)"
      purpose: "Add uniqueness validation to dag validate command"
      story_reference: "US-006"
      independent_test: "Create two DAGs with same ID, run 'dag validate', verify error"
      tasks:
        - id: "T015"
          title: "Add ValidateDAGUniqueness function in internal/dag/validate.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-006"
          file_path: "internal/dag/validate.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Scans DAG files for duplicate resolved IDs"
            - "Returns error identifying conflicting files on duplicate ID"
            - "Produces warning on duplicate names (even if id differs)"
            - "Function under 40 lines"
            - "Errors wrapped with context"
        - id: "T016"
          title: "Add tests for DAG uniqueness validation"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: "US-006"
          file_path: "internal/dag/validate_test.go"
          dependencies: ["T015"]
          acceptance_criteria:
            - "Tests duplicate resolved ID detection"
            - "Tests duplicate name warning"
            - "Tests unique IDs pass validation"
            - "Tests explicit id vs slugified name collision"
            - "Uses map[string]struct{} table test pattern"
    - number: 7
      title: "Polish & Cross-Cutting Concerns"
      purpose: "Quality gates, documentation, backward compatibility"
      tasks:
        - id: "T017"
          title: "Update docs/public/dag-orchestration.md with new branch naming"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "docs/public/dag-orchestration.md"
          dependencies: ["T014", "T016"]
          acceptance_criteria:
            - "Document new branch format dag/<dag-id>/<spec-id>"
            - "Document worktree format dag-<dag-id>-<spec-id>"
            - "Document ID resolution priority: dag.id > dag.name > filename"
            - "Document ID immutability and mismatch error"
            - "Document collision handling behavior"
            - "Document dag validate uniqueness checks"
        - id: "T018"
          title: "Run quality gates: make test && make fmt && make lint && make build"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: ""
          dependencies: ["T017"]
          acceptance_criteria:
            - "make test exits 0"
            - "make fmt exits 0"
            - "make lint exits 0"
            - "make build exits 0"
            - "FR-014 satisfied"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-003", "US-004"]
        - story_id: "US-002"
          depends_on: []
          blocks: []
        - story_id: "US-003"
          depends_on: ["US-001"]
          blocks: []
        - story_id: "US-004"
          depends_on: ["US-001"]
          blocks: []
        - story_id: "US-005"
          depends_on: ["US-001"]
          blocks: []
        - story_id: "US-006"
          depends_on: []
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3, 6]
        - phase: 3
          blocks: [4, 5]
        - phase: 4
          blocks: [7]
        - phase: 5
          blocks: [7]
        - phase: 6
          blocks: [7]
parallel_execution:
    - phase: 2
      parallel_groups:
        - tasks: ["T003", "T004"]
          rationale: "Different files (types.go vs runstate.go), no dependencies between them"
    - phase: 7
      parallel_groups:
        - tasks: ["T017"]
          rationale: "Documentation can be written while quality gates are prepared"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3]
        description: "Setup + Type Extensions + Self-documenting branch names (US-001)"
        validation: "Run a DAG and verify branch names use dag/<dag-id>/<spec-id> format"
    incremental_delivery:
        - milestone: "Foundation Ready"
          phases: [1, 2]
          deliverable: "Slugify and ResolveDAGID functions with comprehensive tests"
        - milestone: "MVP Complete"
          phases: [1, 2, 3]
          deliverable: "Human-readable branch names working for new DAG runs"
        - milestone: "Resume & Safety"
          phases: [1, 2, 3, 4]
          deliverable: "Resume uses stored branches, ID mismatch detection prevents orphaned branches"
        - milestone: "Full Feature"
          phases: [1, 2, 3, 4, 5, 6, 7]
          deliverable: "Complete feature with collision handling, validation, documentation"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec v0.8.2"
    created: "2026-01-11T20:25:54Z"
    artifact_type: "tasks"
