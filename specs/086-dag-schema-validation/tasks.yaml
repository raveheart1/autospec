tasks:
    branch: "086-dag-schema-validation"
    created: "2026-01-11"
    spec_path: "specs/086-dag-schema-validation/spec.yaml"
    plan_path: "specs/086-dag-schema-validation/plan.yaml"
summary:
    total_tasks: 14
    total_phases: 5
    parallel_opportunities: 4
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Create package structure for DAG validation"
      tasks:
        - id: "T001"
          title: "Create internal/dag/ package directory"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "internal/dag/"
          dependencies: []
          acceptance_criteria:
            - "Directory internal/dag/ exists"
            - "Package can be imported by other packages"
        - id: "T002"
          title: "Create internal/cli/dag/ package directory"
          status: "Completed"
          type: "setup"
          parallel: true
          story_id: null
          file_path: "internal/cli/dag/"
          dependencies: []
          acceptance_criteria:
            - "Directory internal/cli/dag/ exists"
            - "Package can be imported by CLI commands"
    - number: 2
      title: "Foundational"
      purpose: "Core types and parser that MUST be complete before user stories"
      tasks:
        - id: "T003"
          title: "Implement DAG types (DAGConfig, Layer, Feature) in internal/dag/types.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/dag/types.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "DAGConfig struct with SchemaVersion, DAG, Layers fields"
            - "DAGMetadata struct with Name field"
            - "Layer struct with ID, Name, DependsOn, Features fields"
            - "Feature struct with ID, Description, DependsOn (optional), Timeout (optional) fields"
            - "All structs have YAML tags for parsing"
            - "All functions under 40 lines"
        - id: "T004"
          title: "Implement YAML parser with line number tracking in internal/dag/parser.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/dag/parser.go"
          dependencies: ["T003"]
          acceptance_criteria:
            - "ParseDAGFile(path string) (*DAGConfig, error) function"
            - "Uses yaml.v3 Node API for line number tracking"
            - "Returns parse errors with line numbers"
            - "Errors wrapped with context using fmt.Errorf with %w"
            - "All functions under 40 lines"
        - id: "T005"
          title: "Implement validation error types in internal/dag/errors.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/dag/errors.go"
          dependencies: ["T003"]
          acceptance_criteria:
            - "ValidationError type with Line, Column, Message fields"
            - "CycleError type that includes cycle path"
            - "MissingSpecError type with expected path"
            - "InvalidLayerRefError type for invalid layer references"
            - "Error() methods implement error interface"
    - number: 3
      title: "User Story 1 - Validate DAG Configuration"
      purpose: "Enable developers to validate DAG files for structural correctness"
      story_reference: "US-001"
      independent_test: "Create a DAG file, run validation command, verify pass/fail result"
      tasks:
        - id: "T006"
          title: "Implement DAG validator in internal/dag/validator.go"
          status: "InProgress"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/dag/validator.go"
          dependencies: ["T004", "T005"]
          acceptance_criteria:
            - "ValidateDAG(cfg *DAGConfig, specsDir string) []error function"
            - "Validates required fields (schema_version, dag.name, layers)"
            - "Detects cycles in feature dependencies using DFS algorithm"
            - "Validates spec folders exist in specs/<id>/"
            - "Validates layer dependencies reference existing layers"
            - "Detects duplicate feature IDs across layers"
            - "Returns clear error messages with actionable guidance"
            - "Validation completes in <10ms for 50 features"
            - "All functions under 40 lines"
        - id: "T007"
          title: "Implement dag validate CLI command in internal/cli/dag/validate.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/cli/dag/validate.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "validateCmd with Use: 'validate <file>'"
            - "Accepts file path argument"
            - "Returns exit code 0 for valid files"
            - "Returns non-zero exit code for invalid files"
            - "Displays 'Valid' message on success"
            - "Displays validation errors with line numbers on failure"
            - "All functions under 40 lines"
    - number: 4
      title: "User Story 2 - Visualize DAG Structure"
      purpose: "Enable developers to see ASCII diagrams of DAG dependencies"
      story_reference: "US-002"
      independent_test: "Create a DAG file, run visualization command, verify ASCII output"
      tasks:
        - id: "T008"
          title: "Implement ASCII visualizer in internal/dag/visualizer.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/dag/visualizer.go"
          dependencies: ["T003"]
          acceptance_criteria:
            - "RenderASCII(cfg *DAGConfig) string function"
            - "Shows layers with their features"
            - "Shows arrows indicating dependencies"
            - "Uses ASCII-only characters (no Unicode)"
            - "Output fits within 80-120 character terminal width"
            - "All functions under 40 lines"
        - id: "T009"
          title: "Implement dag visualize CLI command in internal/cli/dag/visualize.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/cli/dag/visualize.go"
          dependencies: ["T006", "T008"]
          acceptance_criteria:
            - "visualizeCmd with Use: 'visualize <file>'"
            - "Accepts file path argument"
            - "Validates DAG before rendering (shows errors instead of diagram if invalid)"
            - "Outputs ASCII diagram to stdout"
            - "All functions under 40 lines"
    - number: 5
      title: "User Story 3 - Define DAG Schema & Integration"
      purpose: "Complete CLI integration and documentation"
      story_reference: "US-003"
      independent_test: "Create DAG file following schema, verify it parses and validates correctly"
      tasks:
        - id: "T010"
          title: "Implement parent dag command in internal/cli/dag/dag.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/cli/dag/dag.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "DagCmd parent command with Use: 'dag'"
            - "Short and Long descriptions explain DAG orchestration"
            - "Adds validate and visualize subcommands in init()"
            - "Follows worktree.go command group pattern"
            - "All functions under 40 lines"
        - id: "T011"
          title: "Register dag commands in CLI root"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/cli/root.go"
          dependencies: ["T010", "T007", "T009"]
          acceptance_criteria:
            - "DagCmd added to root command"
            - "Command appears in autospec --help output"
            - "Subcommands accessible via autospec dag validate/visualize"
        - id: "T012"
          title: "Add unit tests for parser and validator in internal/dag/*_test.go"
          status: "Pending"
          type: "test"
          parallel: true
          story_id: "US-003"
          file_path: "internal/dag/parser_test.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Map-based table tests for parser edge cases"
            - "Map-based table tests for all validation scenarios"
            - "Tests for cycle detection with cycle path in error"
            - "Tests for missing spec folder validation"
            - "Tests for invalid layer references"
            - "Tests for duplicate feature IDs"
            - "Tests for YAML parse errors with line numbers"
        - id: "T013"
          title: "Add unit tests for visualizer in internal/dag/visualizer_test.go"
          status: "Pending"
          type: "test"
          parallel: true
          story_id: "US-003"
          file_path: "internal/dag/visualizer_test.go"
          dependencies: ["T008"]
          acceptance_criteria:
            - "Map-based table tests for visualization output"
            - "Tests for multi-layer DAGs"
            - "Tests for DAGs with dependencies"
            - "Verifies ASCII-only output (no Unicode)"
        - id: "T014"
          title: "Verify all quality gates pass"
          status: "Pending"
          type: "documentation"
          parallel: false
          story_id: "US-003"
          file_path: "docs/public/dag-validation.md"
          dependencies: ["T011", "T012", "T013"]
          acceptance_criteria:
            - "make test passes"
            - "make fmt passes"
            - "make lint passes"
            - "make build passes"
            - "User documentation in docs/public/dag-validation.md"
dependencies:
    user_story_order:
        - story_id: "US-003"
          depends_on: []
          blocks: ["US-001", "US-002"]
        - story_id: "US-001"
          depends_on: ["US-003"]
          blocks: []
        - story_id: "US-002"
          depends_on: ["US-003"]
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3, 4]
        - phase: 3
          blocks: [5]
        - phase: 4
          blocks: [5]
parallel_execution:
    - phase: 1
      parallel_groups:
        - tasks: ["T001", "T002"]
          rationale: "Different package directories, no dependencies"
    - phase: 2
      parallel_groups:
        - tasks: ["T004", "T005"]
          rationale: "Parser and error types can be developed in parallel after types are defined"
    - phase: 5
      parallel_groups:
        - tasks: ["T012", "T013"]
          rationale: "Unit tests for different packages can run in parallel"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3]
        description: "Setup + Foundational + Validation command"
        validation: "Run autospec dag validate on a test DAG file"
    incremental_delivery:
        - milestone: "Foundation Ready"
          phases: [1, 2]
          deliverable: "DAG types, parser, and error types available for use"
        - milestone: "Validation Complete"
          phases: [1, 2, 3]
          deliverable: "autospec dag validate command fully functional"
        - milestone: "Visualization Complete"
          phases: [1, 2, 3, 4]
          deliverable: "autospec dag visualize command fully functional"
        - milestone: "Feature Complete"
          phases: [1, 2, 3, 4, 5]
          deliverable: "Full DAG schema validation with tests and documentation"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec 0.8.2"
    created: "2026-01-11T07:35:47Z"
    artifact_type: "tasks"
