tasks:
    branch: "103-precompute-prereqs-context"
    created: "2026-01-16"
    spec_path: "specs/103-precompute-prereqs-context/spec.yaml"
    plan_path: "specs/103-precompute-prereqs-context/plan.yaml"
summary:
    total_tasks: 18
    total_phases: 6
    parallel_opportunities: 8
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Project initialization and new package structure"
      tasks:
        - id: "T001"
          title: "Create internal/prereqs package directory structure"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "internal/prereqs/"
          dependencies: []
          acceptance_criteria:
            - "internal/prereqs/ directory exists"
            - "Package can be imported by other internal packages"
    - number: 2
      title: "Foundational"
      purpose: "Core infrastructure that MUST be complete before user stories"
      tasks:
        - id: "T002"
          title: "Extract PrereqsContext struct to internal/prereqs/context.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/prereqs/context.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "PrereqsContext struct with fields: FeatureDir, FeatureSpec, ImplPlan, TasksFile, AutospecVersion, CreatedDate, IsGitRepo, AvailableDocs"
            - "Struct is exported and documented"
            - "Fields use proper Go types (string, bool, []string)"
        - id: "T003"
          title: "Implement ComputeContext function in internal/prereqs/context.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/prereqs/context.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "ComputeContext accepts options for require-spec, require-plan, require-tasks flags"
            - "Returns PrereqsContext populated from current directory/git state"
            - "Reuses existing prereqs detection logic from internal/cli/prereqs.go"
            - "Error handling wraps errors with context using fmt.Errorf"
            - "Function is under 40 lines (extract helpers as needed)"
        - id: "T004"
          title: "Write unit tests for PrereqsContext in internal/prereqs/context_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/prereqs/context_test.go"
          dependencies: ["T003"]
          acceptance_criteria:
            - "Uses map-based table tests pattern"
            - "Tests ComputeContext with feature dir present"
            - "Tests ComputeContext with missing spec.yaml"
            - "Tests ComputeContext with missing plan.yaml"
            - "Tests ComputeContext outside git repo"
            - "Tests error cases for required files"
        - id: "T005"
          title: "Refactor internal/cli/prereqs.go to use shared ComputeContext"
          status: "Completed"
          type: "refactor"
          parallel: false
          story_id: null
          file_path: "internal/cli/prereqs.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "prereqs CLI command uses prereqs.ComputeContext internally"
            - "CLI behavior unchanged (backward compatible)"
            - "JSON output format unchanged"
            - "All existing prereqs tests still pass"
    - number: 3
      title: "User Story 1 & 2 - Pre-computed prereqs context and eliminate bash calls"
      purpose: "Enable slash commands to receive pre-computed prereqs context without bash execution"
      story_reference: "US-001, US-002"
      independent_test: "Invoke a slash command and verify prereqs context is available without bash execution"
      tasks:
        - id: "T006"
          title: "Create RenderTemplate function in internal/commands/render.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/commands/render.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "RenderTemplate accepts command content and PrereqsContext"
            - "Uses Go text/template to substitute {{.VariableName}} placeholders"
            - "Returns rendered string or error"
            - "Function is under 40 lines"
        - id: "T007"
          title: "Define command requirements mapping in internal/commands/render.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-001"
          file_path: "internal/commands/render.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Map of command names to required variables (e.g., plan requires FeatureSpec)"
            - "constitution only requires AutospecVersion and CreatedDate"
            - "implement requires TasksFile"
            - "Exported function to get requirements for a command"
        - id: "T008"
          title: "Implement template variable validation in internal/commands/render.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-001"
          file_path: "internal/commands/render.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "ValidateRequirements checks PrereqsContext against command requirements"
            - "Returns clear error message listing missing required variables"
            - "Follows Actionable Errors constitution principle"
        - id: "T009"
          title: "Write unit tests for template rendering in internal/commands/render_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/commands/render_test.go"
          dependencies: ["T008"]
          acceptance_criteria:
            - "Uses map-based table tests pattern"
            - "Tests successful rendering with all variables"
            - "Tests rendering with partial context"
            - "Tests error when required variable missing"
            - "Tests various template syntax edge cases"
    - number: 4
      title: "User Story 3 - Template variable substitution in command files"
      purpose: "Update command markdown files to use template variables instead of bash prereqs calls"
      story_reference: "US-003"
      independent_test: "Create a command file with template variables and verify they render correctly"
      tasks:
        - id: "T010"
          title: "Update autospec.plan.md to use template variables"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-003"
          file_path: "internal/commands/autospec.plan.md"
          dependencies: ["T009"]
          acceptance_criteria:
            - "Replace bash prereqs call with {{.FeatureDir}}, {{.FeatureSpec}}, {{.AutospecVersion}}, {{.CreatedDate}}"
            - "Remove Step 1 that runs autospec prereqs --json --require-spec"
            - "Update instructions to reference pre-computed paths directly"
        - id: "T011"
          title: "Update autospec.tasks.md to use template variables"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-003"
          file_path: "internal/commands/autospec.tasks.md"
          dependencies: ["T009"]
          acceptance_criteria:
            - "Replace bash prereqs call with {{.FeatureDir}}, {{.FeatureSpec}}, {{.ImplPlan}}, {{.AutospecVersion}}, {{.CreatedDate}}"
            - "Remove Step 1 that runs autospec prereqs --json --require-plan"
            - "Update instructions to reference pre-computed paths directly"
        - id: "T012"
          title: "Update autospec.implement.md to use template variables"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-003"
          file_path: "internal/commands/autospec.implement.md"
          dependencies: ["T009"]
          acceptance_criteria:
            - "Replace bash prereqs call with {{.FeatureDir}}, {{.TasksFile}}"
            - "Remove prereqs bash call instruction"
            - "Update instructions to reference pre-computed paths directly"
        - id: "T013"
          title: "Update remaining command files (checklist, clarify, analyze, constitution)"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-003"
          file_path: "internal/commands/"
          dependencies: ["T009"]
          acceptance_criteria:
            - "autospec.checklist.md uses {{.FeatureDir}}, {{.FeatureSpec}}"
            - "autospec.clarify.md uses {{.FeatureDir}}, {{.FeatureSpec}}"
            - "autospec.analyze.md uses {{.FeatureDir}}, {{.FeatureSpec}}"
            - "autospec.constitution.md uses {{.AutospecVersion}}, {{.CreatedDate}}"
            - "All bash prereqs calls removed from these files"
    - number: 5
      title: "User Story 4 - Integration and backward compatibility"
      purpose: "Integrate template rendering into execution flow and ensure existing workflows continue to work"
      story_reference: "US-004"
      independent_test: "Run existing workflows after upgrade and verify identical outcomes"
      tasks:
        - id: "T014"
          title: "Integrate template rendering at slash command invocation point"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-004"
          file_path: "internal/cliagent/"
          dependencies: ["T010", "T011", "T012", "T013"]
          acceptance_criteria:
            - "Identify where slash commands are loaded and passed to agents"
            - "Call prereqs.ComputeContext before rendering"
            - "Call commands.RenderTemplate with context before agent invocation"
            - "Handle rendering errors gracefully with clear messages"
        - id: "T015"
          title: "Write integration tests for command rendering with real feature context"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-004"
          file_path: "internal/commands/render_integration_test.go"
          dependencies: ["T014"]
          acceptance_criteria:
            - "Tests render all 7 command files with realistic PrereqsContext"
            - "Verifies no {{.Variable}} placeholders remain in output"
            - "Verifies paths are resolved correctly"
            - "Tests backward compatibility: commands with old bash pattern still work"
    - number: 6
      title: "Polish & Cross-Cutting Concerns"
      purpose: "Final validation, documentation, and release preparation"
      tasks:
        - id: "T016"
          title: "Run quality gates and fix any issues"
          status: "InProgress"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "."
          dependencies: ["T015"]
          acceptance_criteria:
            - "make fmt exits 0"
            - "make lint exits 0"
            - "make test exits 0"
            - "make build exits 0"
        - id: "T017"
          title: "Create manual testing plan in .dev/tasks/103-precompute-prereqs-context.md"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: ".dev/tasks/103-precompute-prereqs-context.md"
          dependencies: ["T016"]
          acceptance_criteria:
            - "Document manual test steps for each user story"
            - "Include steps to verify no bash prereqs calls occur"
            - "Include steps to verify template rendering works"
            - "Include Report Summaries section for results"
        - id: "T018"
          title: "Update CHANGELOG.md with feature summary"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "CHANGELOG.md"
          dependencies: ["T016"]
          acceptance_criteria:
            - "1-3 user-facing bullets summarizing the feature"
            - "Mention elimination of bash prereqs calls"
            - "Mention template variable support in command files"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-003"]
        - story_id: "US-002"
          depends_on: []
          blocks: []
        - story_id: "US-003"
          depends_on: ["US-001"]
          blocks: ["US-004"]
        - story_id: "US-004"
          depends_on: ["US-003"]
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3]
        - phase: 3
          blocks: [4]
        - phase: 4
          blocks: [5]
        - phase: 5
          blocks: [6]
parallel_execution:
    - phase: 3
      parallel_groups:
        - tasks: ["T007", "T008"]
          rationale: "Independent functions in same file, no dependencies on each other"
    - phase: 4
      parallel_groups:
        - tasks: ["T010", "T011", "T012", "T013"]
          rationale: "Different command files, no dependencies between them"
    - phase: 6
      parallel_groups:
        - tasks: ["T017", "T018"]
          rationale: "Documentation tasks can be done in parallel after quality gates pass"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3]
        description: "Setup + Foundational + Core prereqs context and template rendering"
        validation: "Run unit tests, verify ComputeContext returns expected data, verify RenderTemplate substitutes variables"
    incremental_delivery:
        - milestone: "Foundation Ready"
          phases: [1, 2]
          deliverable: "PrereqsContext struct and ComputeContext function available for use"
        - milestone: "Rendering Infrastructure"
          phases: [1, 2, 3]
          deliverable: "Template rendering system complete with validation"
        - milestone: "Commands Migrated"
          phases: [1, 2, 3, 4]
          deliverable: "All 7 command files use template variables"
        - milestone: "Fully Integrated"
          phases: [1, 2, 3, 4, 5]
          deliverable: "Slash commands receive pre-computed context without bash calls"
        - milestone: "Release Ready"
          phases: [1, 2, 3, 4, 5, 6]
          deliverable: "All quality gates pass, documentation complete"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec 0.9.0"
    created: "2026-01-16T22:48:21Z"
    artifact_type: "tasks"
