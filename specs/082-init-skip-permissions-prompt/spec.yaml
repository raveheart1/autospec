feature:
  branch: "082-init-skip-permissions-prompt"
  created: "2026-01-06"
  status: "Draft"
  input: "im thinking of doing a new 'autospec init' prompt when claude is selected we prompt to ask to enable/disable our new flag: 'skip_permissions' flag. (default false) - explaining that autospec may fail if users dont have enough claude permissions set. This should ease setup for them without forcing them to enable it. show 'autospec config toggle' command as hint when needed - note its safer after claude sandbox is set (but still ask when sandbox is set or not). note if users already have comprehensive permissions set and are confident - claude wont have permission errors they may keep this as false"

user_stories:
  - id: "US-001"
    title: "Enable skip_permissions during init"
    priority: "P1"
    as_a: "developer setting up autospec for the first time"
    i_want: "to be prompted about the skip_permissions flag during 'autospec init' when Claude is selected"
    so_that: "I can easily configure autospec to run without permission prompts if I don't have comprehensive Claude permissions set"
    why_this_priority: "Core feature that directly addresses the user friction of permission errors during autospec workflows"
    independent_test: "Run 'autospec init', select Claude agent, verify the skip_permissions prompt appears with appropriate explanation"
    acceptance_scenarios:
      - given: "I run 'autospec init' and select Claude as the agent"
        when: "the init wizard reaches the permissions configuration step"
        then: "I am prompted to enable or disable skip_permissions with a clear explanation of what it does"
      - given: "I am prompted about skip_permissions"
        when: "the prompt is displayed"
        then: "I see an explanation that autospec may fail without sufficient Claude permissions and that enabling this flag runs in autonomous mode"

  - id: "US-002"
    title: "Understand skip_permissions implications"
    priority: "P1"
    as_a: "developer"
    i_want: "to understand the tradeoffs of enabling skip_permissions"
    so_that: "I can make an informed decision based on my Claude configuration"
    why_this_priority: "Users must understand the security and workflow implications before making this choice"
    independent_test: "Verify the prompt text includes all relevant context about when to enable/disable the flag"
    acceptance_scenarios:
      - given: "I am viewing the skip_permissions prompt"
        when: "I read the explanation"
        then: "I understand that enabling this is safer after Claude sandbox is configured"
      - given: "I am viewing the skip_permissions prompt"
        when: "I read the explanation"
        then: "I understand that if I already have comprehensive Claude permissions configured, I may keep this disabled"
      - given: "I am viewing the skip_permissions prompt"
        when: "I read the explanation"
        then: "I see a hint about 'autospec config toggle' for changing this setting later"

  - id: "US-003"
    title: "Configure skip_permissions regardless of sandbox status"
    priority: "P2"
    as_a: "developer"
    i_want: "to be asked about skip_permissions whether or not Claude sandbox is configured"
    so_that: "I can set up autospec with the appropriate permissions mode regardless of my current Claude setup"
    why_this_priority: "Flexibility to configure during init regardless of sandbox state, though sandbox provides additional safety"
    independent_test: "Run 'autospec init' with sandbox configured and without, verify prompt appears in both cases"
    acceptance_scenarios:
      - given: "I run 'autospec init' without Claude sandbox configured"
        when: "the skip_permissions prompt appears"
        then: "I can still choose to enable or disable the flag"
      - given: "I run 'autospec init' with Claude sandbox configured"
        when: "the skip_permissions prompt appears"
        then: "I can still choose to enable or disable the flag and the prompt notes this is the safer scenario"

requirements:
  functional:
    - id: "FR-001"
      description: "MUST prompt user about skip_permissions flag when Claude agent is selected during 'autospec init'"
      testable: true
      acceptance_criteria: "Selecting Claude agent triggers skip_permissions prompt in init wizard"
    - id: "FR-002"
      description: "MUST display explanation that autospec may fail without sufficient Claude permissions when skip_permissions is disabled"
      testable: true
      acceptance_criteria: "Prompt text includes warning about potential permission failures"
    - id: "FR-003"
      description: "MUST show 'autospec config toggle skip_permissions' command as a hint for changing the setting later"
      testable: true
      acceptance_criteria: "Prompt text includes the toggle command hint"
    - id: "FR-004"
      description: "MUST note that enabling skip_permissions is safer after Claude sandbox is configured"
      testable: true
      acceptance_criteria: "Prompt text mentions sandbox configuration as a safety recommendation"
    - id: "FR-005"
      description: "MUST explain that users with comprehensive Claude permissions may keep skip_permissions disabled"
      testable: true
      acceptance_criteria: "Prompt text includes guidance for users with existing comprehensive permissions"
    - id: "FR-006"
      description: "MUST default skip_permissions to false when user declines or skips the prompt"
      testable: true
      acceptance_criteria: "Config file shows skip_permissions: false when prompt is declined or skipped"
    - id: "FR-007"
      description: "MUST save the user's skip_permissions choice to the config file"
      testable: true
      acceptance_criteria: "Config file reflects the user's selection after init completes"
    - id: "FR-008"
      description: "MUST show the skip_permissions prompt regardless of whether Claude sandbox is currently configured"
      testable: true
      acceptance_criteria: "Prompt appears in init wizard for Claude agent with and without sandbox configured"
    - id: "FR-009"
      description: "MUST pass all quality gates: make test, make fmt, make lint, and make build"
      testable: true
      acceptance_criteria: "All commands exit 0; no test failures, format changes, lint errors, or build failures"

  non_functional:
    - id: "NFR-001"
      category: "usability"
      description: "Prompt text must be clear and concise, explaining the flag's purpose in 2-3 sentences maximum"
      measurable_target: "Prompt explanation is under 300 characters"
    - id: "NFR-002"
      category: "usability"
      description: "Prompt must use consistent terminology with existing autospec init prompts"
      measurable_target: "Prompt follows same style and formatting as other init prompts"
    - id: "NFR-003"
      category: "code_quality"
      description: "All functions must be under 40 lines; extract helpers for complex logic"
      measurable_target: "No function exceeds 40 lines excluding comments"
    - id: "NFR-004"
      category: "code_quality"
      description: "All errors must be wrapped with context using fmt.Errorf(\"doing X: %w\", err)"
      measurable_target: "Zero bare 'return err' statements in new code"
    - id: "NFR-005"
      category: "code_quality"
      description: "Tests must use map-based table-driven pattern"
      measurable_target: "All new test functions use map[string]struct pattern"
    - id: "NFR-006"
      category: "code_quality"
      description: "Accept interfaces, return concrete types"
      measurable_target: "Function signatures follow interface-in, concrete-out pattern where applicable"

success_criteria:
  measurable_outcomes:
    - id: "SC-001"
      description: "Users selecting Claude in 'autospec init' are prompted about skip_permissions"
      metric: "Percentage of Claude agent selections that trigger the prompt"
      target: "100%"
    - id: "SC-002"
      description: "Users can complete the skip_permissions configuration within the init flow without external documentation"
      metric: "Prompt self-containment - includes all necessary context"
      target: "Prompt includes: purpose, tradeoffs, default, and toggle command hint"
    - id: "SC-003"
      description: "skip_permissions setting is correctly persisted after init"
      metric: "Config file accuracy after init"
      target: "100% of user selections correctly saved to config"

key_entities:
  - name: "skip_permissions flag"
    description: "Configuration setting that controls whether autospec runs Claude in autonomous mode without permission prompts"
    attributes:
      - "Default value: false"
      - "Stored in config file (project or user level)"
      - "Can be toggled via 'autospec config toggle skip_permissions'"
  - name: "autospec init wizard"
    description: "Interactive setup process for configuring autospec in a project"
    attributes:
      - "Prompts for agent selection"
      - "Configures agent-specific settings"
      - "Creates config files"

edge_cases:
  - scenario: "User interrupts init during skip_permissions prompt"
    expected_behavior: "Partial config is not saved; user must re-run init"
  - scenario: "User selects non-Claude agent"
    expected_behavior: "skip_permissions prompt is not shown (only relevant for Claude)"
  - scenario: "User runs init on a project that already has skip_permissions configured"
    expected_behavior: "Show current value and allow user to change it"
  - scenario: "Config file is read-only or write fails"
    expected_behavior: "Display error message with instructions to fix permissions"

assumptions:
  - "The skip_permissions flag already exists in the config schema"
  - "The 'autospec config toggle' command already supports the skip_permissions field"
  - "The init wizard infrastructure supports conditional prompts based on agent selection"
  - "Users running init have basic familiarity with Claude and its permission system"

constraints:
  - "Must integrate with existing init wizard flow without disrupting other prompts"
  - "Prompt must be shown only when Claude agent is selected, not for other agents"
  - "Default behavior (false) must be preserved when prompt is skipped or declined"

out_of_scope:
  - "Detecting Claude sandbox configuration status automatically"
  - "Modifying Claude's actual permission settings"
  - "Adding skip_permissions support for non-Claude agents"
  - "Auto-enabling skip_permissions based on detected permission errors"
  - "GUI or web-based configuration interface"

_meta:
  version: "1.0.0"
  generator: "autospec"
  generator_version: "autospec v0.8.1"
  created: "2026-01-06T03:44:27Z"
  artifact_type: "spec"
