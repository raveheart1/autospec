feature:
    branch: "039-blocked-task-reason"
    created: "2025-12-17"
    status: "Completed"
    completed_at: 2025-12-17T21:56:04Z
    input: "implement .dev/tasks/blocked-task-reason-field.md"
user_stories:
    - id: "US-001"
      title: "Document blocked task reason"
      priority: "P1"
      as_a: "developer or AI agent"
      i_want: "to add a reason when blocking a task"
      so_that: "others can understand why progress is halted and what needs to be resolved"
      why_this_priority: "Core functionality - without this, blocked tasks lack context and are harder to prioritize for unblocking"
      independent_test: "Block a task with a reason and verify the reason is stored and retrievable"
      acceptance_scenarios:
        - given: "a task in tasks.yaml with status Pending or InProgress"
          when: "I run a command to block the task with a reason"
          then: "the task status changes to Blocked and the reason is captured in a blocked_reason field"
        - given: "a task with status Blocked and a blocked_reason"
          when: "I view the task details"
          then: "the blocked_reason is displayed alongside the status"
    - id: "US-002"
      title: "Unblock a task"
      priority: "P1"
      as_a: "developer or AI agent"
      i_want: "to unblock a task and optionally set its new status"
      so_that: "work can resume on the task once the blocking issue is resolved"
      why_this_priority: "Completes the block/unblock workflow - essential for task lifecycle management"
      independent_test: "Unblock a blocked task and verify status changes and reason is handled appropriately"
      acceptance_scenarios:
        - given: "a task with status Blocked and a blocked_reason"
          when: "I run a command to unblock the task"
          then: "the task status changes to Pending and the blocked_reason is removed"
        - given: "a blocked task"
          when: "I unblock with --status InProgress flag"
          then: "the task status changes directly to InProgress"
    - id: "US-003"
      title: "View blocked tasks with reasons"
      priority: "P2"
      as_a: "developer or project manager"
      i_want: "to see all blocked tasks along with their blocking reasons"
      so_that: "I can quickly assess blockers and prioritize resolution efforts"
      why_this_priority: "Provides immediate visibility into what's blocking progress - key for project management"
      independent_test: "Run status command and verify blocked tasks show their reasons"
      acceptance_scenarios:
        - given: "a tasks.yaml with 3 blocked tasks, 2 with reasons and 1 without"
          when: "I run autospec st or autospec task list --blocked"
          then: "all blocked tasks are listed with their reasons (or indication of missing reason)"
    - id: "US-004"
      title: "Validate blocked_reason field"
      priority: "P2"
      as_a: "developer"
      i_want: "the system to warn me when a blocked task has no reason"
      so_that: "I remember to document why tasks are blocked for better tracking"
      why_this_priority: "Encourages good practices without breaking existing workflows"
      independent_test: "Validate a tasks.yaml with a blocked task without reason and verify warning is emitted"
      acceptance_scenarios:
        - given: "a tasks.yaml with a task having status: Blocked but no blocked_reason"
          when: "I run autospec artifact tasks.yaml"
          then: "a validation warning (not error) is shown suggesting to add blocked_reason"
        - given: "a task with blocked_reason but status is not Blocked"
          when: "I run autospec artifact tasks.yaml"
          then: "no error is raised but the field is effectively ignored or a minor warning is shown"
requirements:
    functional:
        - id: "FR-001"
          description: "MUST add blocked_reason as an optional field to the TaskItem struct in Go"
          testable: true
          acceptance_criteria: "TaskItem struct includes BlockedReason string yaml field, tasks with blocked_reason parse correctly"
        - id: "FR-002"
          description: "MUST validate that when status is Blocked and blocked_reason is missing, a warning is emitted"
          testable: true
          acceptance_criteria: "Validation returns warning (not error) for blocked tasks without reason"
        - id: "FR-003"
          description: "MUST implement 'autospec task block <id> --reason <text>' command"
          testable: true
          acceptance_criteria: "Command sets status to Blocked and populates blocked_reason field"
        - id: "FR-004"
          description: "MUST implement 'autospec task unblock <id>' command with optional --status flag"
          testable: true
          acceptance_criteria: "Command sets status to Pending (default) or specified status, removes blocked_reason"
        - id: "FR-005"
          description: "MUST update autospec st output to display blocked tasks with their reasons"
          testable: true
          acceptance_criteria: "Status output shows blocked task IDs, titles, and reasons when blocked tasks exist"
        - id: "FR-006"
          description: "SHOULD implement 'autospec task list' command with status filters"
          testable: true
          acceptance_criteria: "Command lists tasks filtered by --blocked, --pending, --in-progress, or --completed"
        - id: "FR-007"
          description: "MUST update artifact validation output to show blocked reasons when verbose or blocked > 0"
          testable: true
          acceptance_criteria: "autospec artifact tasks.yaml shows blocked task reasons in summary"
        - id: "FR-008"
          description: "MUST update internal/commands/autospec.*.md slash commands to document task blocking"
          testable: true
          acceptance_criteria: "Slash commands that handle tasks include block/unblock syntax: 'autospec task block T001 --reason \"reason\"' and 'autospec task unblock T001 [--status InProgress]'"
        - id: "FR-009"
          description: "MUST pass all quality gates: make test, make fmt, make lint, and make build"
          testable: true
          acceptance_criteria: "All commands exit 0; no test failures, format changes, lint errors, or build failures"
    non_functional:
        - id: "NFR-001"
          category: "code_quality"
          description: "All functions must be under 40 lines; extract helpers for complex logic"
          measurable_target: "No function exceeds 40 lines excluding comments"
        - id: "NFR-002"
          category: "code_quality"
          description: "All errors must be wrapped with context using fmt.Errorf(\"doing X: %w\", err)"
          measurable_target: "Zero bare 'return err' statements in new code"
        - id: "NFR-003"
          category: "code_quality"
          description: "Tests must use map-based table-driven pattern with t.Parallel()"
          measurable_target: "All new test functions use map[string]struct pattern and call t.Parallel()"
        - id: "NFR-004"
          category: "code_quality"
          description: "Accept interfaces, return concrete types"
          measurable_target: "Function signatures follow interface-in, concrete-out pattern where applicable"
        - id: "NFR-005"
          category: "performance"
          description: "Validation functions must complete quickly"
          measurable_target: "blocked_reason validation adds less than 1ms to total validation time"
        - id: "NFR-006"
          category: "usability"
          description: "Backward compatible with existing tasks.yaml files"
          measurable_target: "Existing tasks.yaml files without blocked_reason validate without errors"
success_criteria:
    measurable_outcomes:
        - id: "SC-001"
          description: "Users can block a task with a reason via CLI"
          metric: "Command execution success rate"
          target: "100% of valid block commands succeed and persist reason"
        - id: "SC-002"
          description: "Blocked tasks display their reasons in status output"
          metric: "Visibility of blocking reasons"
          target: "100% of blocked tasks with reasons show in autospec st output"
        - id: "SC-003"
          description: "Users can unblock tasks and resume work"
          metric: "Unblock command success rate"
          target: "100% of valid unblock commands succeed and change status"
        - id: "SC-004"
          description: "Missing blocked_reason triggers a warning, not an error"
          metric: "Validation behavior"
          target: "Validation passes (exit 0) but warning count increases by 1"
        - id: "SC-005"
          description: "Existing workflows remain unaffected"
          metric: "Backward compatibility"
          target: "All existing tasks.yaml files validate successfully"
key_entities:
    - name: "TaskItem"
      description: "Represents a single task in the tasks.yaml file with status, type, and dependencies"
      attributes:
        - "id - unique task identifier (T001, T002, etc.)"
        - "status - current state (Pending, InProgress, Completed, Blocked)"
        - "blocked_reason - explanation for why task is blocked (new field)"
    - name: "TasksValidator"
      description: "Validates tasks.yaml artifacts against schema and semantic rules"
      attributes:
        - "validates required fields"
        - "checks status enum values"
        - "emits warnings for blocked tasks without reason"
    - name: "TaskCommand"
      description: "CLI parent command for task management operations"
      attributes:
        - "block subcommand with --reason flag"
        - "unblock subcommand with --status flag"
        - "list subcommand with status filters"
edge_cases:
    - scenario: "Block a task that is already blocked"
      expected_behavior: "Update the blocked_reason with the new reason, confirm operation"
    - scenario: "Unblock a task that is not blocked"
      expected_behavior: "Show warning that task is not currently blocked, no changes made"
    - scenario: "Block a completed task"
      expected_behavior: "Allow operation (task can be re-blocked if issues found), update status and reason"
    - scenario: "Task has blocked_reason but status is Completed"
      expected_behavior: "Validation ignores or emits minor warning, does not fail"
    - scenario: "Empty string provided as blocked_reason"
      expected_behavior: "Treat as missing reason, emit validation warning"
    - scenario: "Very long blocked_reason (>500 characters)"
      expected_behavior: "Accept the reason, display may truncate in status output for readability"
assumptions:
    - "The existing update-task command will be maintained for backward compatibility but task subcommands will be the preferred interface"
    - "blocked_reason is a free-form string with no maximum length enforced by validation"
    - "When unblocking, the default target status is Pending unless --status flag specifies otherwise"
    - "The --keep-reason flag for unblock is deferred to a future enhancement if needed"
    - "Task phase structure remains unchanged; blocked_reason is a task-level field only"
    - "Block/unblock commands are used rarely - only for external blockers (dependency on another team, waiting for API access, etc.), not for normal workflow pauses"
constraints:
    - "Must not break existing tasks.yaml files - backward compatibility required"
    - "Must not change existing validation from error to warning or vice versa for other fields"
    - "blocked_reason field must be optional to maintain schema flexibility"
    - "New commands must follow existing CLI patterns and use lifecycle wrapper for notifications"
out_of_scope:
    - "Historical tracking of multiple blocked_reason values over time"
    - "Automatic dependency-based blocking (e.g., auto-block tasks when dependencies are blocked)"
    - "Integration with external issue tracking systems"
    - "Deprecation or removal of existing update-task command"
    - "Adding blocked_reason to spec.yaml or plan.yaml artifacts"
    - "--keep-reason flag for preserving reason after unblock"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec 0.3.2"
    created: "2025-12-17T21:12:30Z"
    artifact_type: "spec"
