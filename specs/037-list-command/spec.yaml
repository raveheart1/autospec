feature:
  branch: "037-list-command"
  created: "2025-12-17"
  status: "Draft"
  input: "Add 'autospec list' command showing all specs in table format with columns: NUM, NAME, STATUS (planned/in-progress/complete), TASKS (done/total), LAST_MODIFIED. Support flags: --status (include status), --sort=date|name|status, --filter=PATTERN, --json."

user_stories:
  - id: "US-001"
    title: "View all feature specifications"
    priority: "P1"
    as_a: "developer"
    i_want: "to see a list of all feature specifications in my project"
    so_that: "I can quickly understand what features exist and their current state"
    why_this_priority: "Core functionality - without this, the command has no purpose"
    independent_test: "Run 'autospec list' in a project with multiple specs and verify table output displays"
    acceptance_scenarios:
      - given: "a project with 3+ feature specifications in the specs/ directory"
        when: "I run 'autospec list'"
        then: "I see a formatted table with NUM, NAME, STATUS, TASKS, and LAST_MODIFIED columns"
      - given: "a project with no feature specifications"
        when: "I run 'autospec list'"
        then: "I see a message indicating no specifications found"

  - id: "US-002"
    title: "Sort specifications by different criteria"
    priority: "P2"
    as_a: "developer"
    i_want: "to sort the specification list by date, name, or status"
    so_that: "I can organize the list based on what's most relevant to my current work"
    why_this_priority: "Enhances usability but not required for basic functionality"
    independent_test: "Run 'autospec list --sort=name' and verify alphabetical ordering"
    acceptance_scenarios:
      - given: "a project with multiple specifications"
        when: "I run 'autospec list --sort=date'"
        then: "specifications are sorted by last modified date, most recent first"
      - given: "a project with multiple specifications"
        when: "I run 'autospec list --sort=name'"
        then: "specifications are sorted alphabetically by name"
      - given: "a project with multiple specifications"
        when: "I run 'autospec list --sort=status'"
        then: "specifications are grouped by status (in-progress, planned, complete)"

  - id: "US-003"
    title: "Filter specifications by pattern"
    priority: "P2"
    as_a: "developer"
    i_want: "to filter specifications by a search pattern"
    so_that: "I can find specific features quickly in large projects"
    why_this_priority: "Important for projects with many specs, but basic listing works without it"
    independent_test: "Run 'autospec list --filter=auth' and verify only matching specs appear"
    acceptance_scenarios:
      - given: "a project with specifications including 'user-auth', 'oauth2-integration', and 'payment-flow'"
        when: "I run 'autospec list --filter=auth'"
        then: "only 'user-auth' and 'oauth2-integration' are shown"
      - given: "a project with multiple specifications"
        when: "I run 'autospec list --filter=nonexistent'"
        then: "I see a message indicating no specifications match the filter"

  - id: "US-004"
    title: "Export specifications in JSON format"
    priority: "P2"
    as_a: "developer"
    i_want: "to output the specification list as JSON"
    so_that: "I can integrate with other tools or scripts"
    why_this_priority: "Enables automation and tooling integration, but not core functionality"
    independent_test: "Run 'autospec list --json' and verify valid JSON output"
    acceptance_scenarios:
      - given: "a project with multiple specifications"
        when: "I run 'autospec list --json'"
        then: "I receive valid JSON containing an array of specification objects"
      - given: "a project with no specifications"
        when: "I run 'autospec list --json'"
        then: "I receive valid JSON with an empty array"

requirements:
  functional:
    - id: "FR-001"
      description: "MUST scan the specs/ directory and identify all feature specification directories"
      testable: true
      acceptance_criteria: "Command discovers all directories in specs/ that contain spec.yaml files"
    - id: "FR-002"
      description: "MUST display NUM column showing the feature number extracted from branch name (e.g., '037' from '037-list-command')"
      testable: true
      acceptance_criteria: "NUM column displays zero-padded feature number for each spec"
    - id: "FR-003"
      description: "MUST display NAME column showing the feature name portion of the branch (e.g., 'list-command' from '037-list-command')"
      testable: true
      acceptance_criteria: "NAME column displays the hyphenated feature name without the number prefix"
    - id: "FR-004"
      description: "MUST display STATUS column showing the feature status derived from artifact presence: 'planned' (has spec.yaml only), 'in-progress' (has tasks.yaml with incomplete tasks), 'complete' (all tasks done)"
      testable: true
      acceptance_criteria: "STATUS accurately reflects the actual state based on artifact files"
    - id: "FR-005"
      description: "MUST display TASKS column in 'done/total' format (e.g., '3/5') when tasks.yaml exists, or '-' when no tasks file"
      testable: true
      acceptance_criteria: "TASKS shows accurate count of completed vs total tasks from tasks.yaml"
    - id: "FR-006"
      description: "MUST display LAST_MODIFIED column showing the most recent modification time of any artifact in the spec directory"
      testable: true
      acceptance_criteria: "LAST_MODIFIED shows human-readable relative time (e.g., '2 hours ago', '3 days ago')"
    - id: "FR-007"
      description: "MUST support --sort flag with values 'date' (default), 'name', or 'status'"
      testable: true
      acceptance_criteria: "Each sort option produces correctly ordered output"
    - id: "FR-008"
      description: "MUST support --filter flag accepting a case-insensitive substring pattern to match against spec names"
      testable: true
      acceptance_criteria: "Only specs matching the filter pattern are displayed"
    - id: "FR-009"
      description: "MUST support --json flag to output results as a JSON array"
      testable: true
      acceptance_criteria: "Output is valid JSON parseable by standard JSON tools"
    - id: "FR-010"
      description: "MUST display informative message when no specifications are found (with or without filters)"
      testable: true
      acceptance_criteria: "Clear message indicates no specs found vs no matches for filter"
    - id: "FR-011"
      description: "MUST pass all quality gates: make test, make fmt, make lint, and make build"
      testable: true
      acceptance_criteria: "All commands exit 0; no test failures, format changes, lint errors, or build failures"

  non_functional:
    - id: "NFR-001"
      category: "performance"
      description: "Command MUST complete within 2 seconds for projects with up to 100 specifications"
      measurable_target: "Execution time < 2 seconds with 100 spec directories"
    - id: "NFR-002"
      category: "usability"
      description: "Table output MUST be properly aligned and readable in standard terminal widths (80+ columns)"
      measurable_target: "Columns align correctly in 80-column terminal"
    - id: "NFR-003"
      category: "code_quality"
      description: "All functions must be under 40 lines; extract helpers for complex logic"
      measurable_target: "No function exceeds 40 lines excluding comments"
    - id: "NFR-004"
      category: "code_quality"
      description: "All errors must be wrapped with context using fmt.Errorf(\"doing X: %w\", err)"
      measurable_target: "Zero bare 'return err' statements in new code"
    - id: "NFR-005"
      category: "code_quality"
      description: "Tests must use map-based table-driven pattern with t.Parallel()"
      measurable_target: "All new test functions use map[string]struct pattern and call t.Parallel()"
    - id: "NFR-006"
      category: "code_quality"
      description: "Accept interfaces, return concrete types"
      measurable_target: "Function signatures follow interface-in, concrete-out pattern where applicable"

success_criteria:
  measurable_outcomes:
    - id: "SC-001"
      description: "Users can view all project specifications in a single command"
      metric: "Command displays complete spec inventory"
      target: "100% of valid spec directories discovered and displayed"
    - id: "SC-002"
      description: "Users can quickly identify feature status at a glance"
      metric: "Status accuracy"
      target: "Status correctly reflects artifact state for all specs"
    - id: "SC-003"
      description: "Users can find specific features efficiently"
      metric: "Filter functionality"
      target: "Filter matches return within 1 second for 100+ specs"
    - id: "SC-004"
      description: "Users can integrate spec data with external tools"
      metric: "JSON output validity"
      target: "JSON output parseable by jq and standard JSON libraries"

key_entities:
  - name: "Specification"
    description: "A feature specification directory containing YAML artifacts"
    attributes:
      - "number: Feature number extracted from directory name"
      - "name: Feature name portion of directory"
      - "status: Derived from artifact presence and task completion"
      - "tasks_completed: Count of done tasks from tasks.yaml"
      - "tasks_total: Total task count from tasks.yaml"
      - "last_modified: Most recent artifact modification time"
  - name: "SpecStatus"
    description: "Enumeration of possible specification states"
    attributes:
      - "planned: Only spec.yaml exists"
      - "in-progress: Has tasks.yaml with incomplete tasks"
      - "complete: All tasks in tasks.yaml are done"

edge_cases:
  - scenario: "Spec directory exists but contains no spec.yaml"
    expected_behavior: "Directory is skipped with optional warning in verbose mode"
  - scenario: "Spec directory name doesn't follow NNN-name pattern"
    expected_behavior: "Display with '???' for NUM and full directory name for NAME"
  - scenario: "tasks.yaml exists but is malformed or empty"
    expected_behavior: "Display '-' for TASKS and 'planned' for STATUS"
  - scenario: "File system permission error reading spec directory"
    expected_behavior: "Skip directory and continue, show warning"
  - scenario: "Very long specification names that would break table alignment"
    expected_behavior: "Truncate NAME to reasonable length with ellipsis"

assumptions:
  - "All feature specifications are stored in the specs/ directory at project root"
  - "Directory names follow the pattern NNN-feature-name where NNN is a zero-padded number"
  - "The spec.yaml file is the minimum required artifact for a valid specification"
  - "Task completion is determined by the 'status' field in tasks.yaml entries"
  - "Default sort order is by date (most recently modified first)"

constraints:
  - "Must integrate with existing autospec CLI command structure"
  - "Must follow existing output formatting patterns used by other autospec commands"
  - "Must work without network access (local filesystem only)"
  - "Must support the existing configuration hierarchy (env > project > user > defaults)"

out_of_scope:
  - "Modifying or deleting specifications through this command"
  - "Creating new specifications (handled by 'autospec new-feature')"
  - "Detailed specification content display (summary/preview)"
  - "Remote/networked specification storage"
  - "Spec validation through this command (handled by 'autospec artifact')"
  - "Integration with git for status determination"

_meta:
  version: "1.0.0"
  generator: "autospec"
  generator_version: "autospec dev"
  created: "2025-12-17T02:46:48Z"
  artifact_type: "spec"
