tasks:
    branch: "102-e2e-mock-testing"
    created: "2026-01-16"
    spec_path: "specs/102-e2e-mock-testing/spec.yaml"
    plan_path: "specs/102-e2e-mock-testing/plan.yaml"
summary:
    total_tasks: 42
    total_phases: 7
    parallel_opportunities: 18
    estimated_complexity: "high"
phases:
    - number: 1
      title: "Setup"
      purpose: "Project initialization and test infrastructure extensions"
      tasks:
        - id: "T001"
          title: "Create mock-opencode.sh script in mocks/scripts/"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "mocks/scripts/mock-opencode.sh"
          dependencies: []
          acceptance_criteria:
            - "Script is executable (chmod +x)"
            - "Script accepts -m flag for message/prompt like opencode"
            - "Script supports all MOCK_* environment variables (MOCK_EXIT_CODE, MOCK_DELAY, MOCK_ARTIFACT_DIR, MOCK_CALL_LOG, MOCK_RESPONSE_FILE)"
            - "Script generates valid YAML artifacts based on detected slash commands"
            - "Script logs invocations when MOCK_CALL_LOG is set"
        - id: "T002"
          title: "Add MOCK_VERSION_INFO and MOCK_NETWORK_STATUS support to mock-claude.sh"
          status: "Completed"
          type: "setup"
          parallel: true
          story_id: null
          file_path: "mocks/scripts/mock-claude.sh"
          dependencies: ["T001"]
          acceptance_criteria:
            - "MOCK_VERSION_INFO env var provides version data for update command testing"
            - "MOCK_NETWORK_STATUS env var simulates connectivity (connected/disconnected)"
            - "Existing functionality unchanged"
        - id: "T003"
          title: "Add MOCK_VERSION_INFO and MOCK_NETWORK_STATUS support to mock-opencode.sh"
          status: "Completed"
          type: "setup"
          parallel: true
          story_id: null
          file_path: "mocks/scripts/mock-opencode.sh"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Same MOCK_VERSION_INFO and MOCK_NETWORK_STATUS support as mock-claude.sh"
            - "Consistent behavior between mock scripts"
        - id: "T004"
          title: "Extend E2EEnv in internal/testutil/e2e.go for OpenCode support"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "internal/testutil/e2e.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "E2EEnv supports agentPreset field (claude or opencode)"
            - "E2EEnv.MockPath includes mock-opencode.sh when preset is opencode"
            - "Helper method to switch agent preset mid-test"
            - "Backward compatible with existing tests"
    - number: 2
      title: "Foundational"
      purpose: "Safety verification and core test helpers that MUST be complete before user stories"
      tasks:
        - id: "T005"
          title: "Add clarify slash command support to mock-claude.sh"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "mocks/scripts/mock-claude.sh"
          dependencies: ["T004"]
          acceptance_criteria:
            - "Mock detects /autospec.clarify in message"
            - "Mock updates spec.yaml with clarifications section"
            - "Generated clarifications are valid YAML"
        - id: "T006"
          title: "Add checklist slash command support to mock-claude.sh"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "mocks/scripts/mock-claude.sh"
          dependencies: ["T004"]
          acceptance_criteria:
            - "Mock detects /autospec.checklist in message"
            - "Mock generates valid checklist.yaml artifact"
            - "Checklist contains items matching test data"
        - id: "T007"
          title: "Add analyze slash command support to mock-claude.sh"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "mocks/scripts/mock-claude.sh"
          dependencies: ["T004"]
          acceptance_criteria:
            - "Mock detects /autospec.analyze in message"
            - "Mock generates valid analysis.yaml artifact"
            - "Analysis contains consistency findings"
        - id: "T008"
          title: "Add same slash command support to mock-opencode.sh"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "mocks/scripts/mock-opencode.sh"
          dependencies: ["T005", "T006", "T007"]
          acceptance_criteria:
            - "mock-opencode.sh supports same slash commands as mock-claude.sh"
            - "specify, plan, tasks, clarify, checklist, analyze all work"
            - "Consistent artifact generation between both mocks"
        - id: "T009"
          title: "Create test data fixtures for checklist.yaml and analysis.yaml"
          status: "Completed"
          type: "setup"
          parallel: true
          story_id: null
          file_path: "tests/e2e/testdata/responses/"
          dependencies: ["T004"]
          acceptance_criteria:
            - "checklist.yaml fixture exists with valid schema"
            - "analysis.yaml fixture exists with valid schema"
            - "Fixtures pass artifact validation"
    - number: 3
      title: "User Story 1 - Safety Verification Tests"
      purpose: "Verify no real API calls are made and environment is properly isolated"
      story_reference: "US-001"
      independent_test: "Run E2E tests and verify ANTHROPIC_API_KEY is not accessible and only mock binaries are in PATH"
      tasks:
        - id: "T010"
          title: "Create safety verification test file tests/e2e/safety_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "tests/e2e/safety_test.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "Test verifies ANTHROPIC_API_KEY not in E2EEnv environment"
            - "Test verifies OPENAI_API_KEY not in E2EEnv environment"
            - "Test verifies PATH only includes mock binaries directory"
            - "Test verifies state files written to temp dir, not ~/.autospec/"
            - "Test verifies GIT_CONFIG_GLOBAL=/dev/null is set"
            - "Uses map-based table test pattern"
        - id: "T011"
          title: "Add E2EEnv verification helper methods"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/testutil/e2e.go"
          dependencies: ["T010"]
          acceptance_criteria:
            - "AssertNoAPIKeys() helper method"
            - "AssertMockOnlyPath() helper method"
            - "AssertTempStateDir() helper method"
            - "AssertGitIsolated() helper method"
    - number: 4
      title: "User Story 2 - OpenCode Agent Mock Support"
      purpose: "Enable E2E testing of autospec with OpenCode agent preset"
      story_reference: "US-002"
      independent_test: "Run autospec with --agent opencode and verify mock-opencode.sh is invoked and generates correct artifacts"
      tasks:
        - id: "T012"
          title: "Create OpenCode workflow E2E test tests/e2e/opencode_test.go"
          status: "InProgress"
          type: "test"
          parallel: false
          story_id: "US-002"
          file_path: "tests/e2e/opencode_test.go"
          dependencies: ["T008"]
          acceptance_criteria:
            - "Test runs autospec specify with --agent opencode"
            - "Test verifies mock-opencode.sh was invoked (via MOCK_CALL_LOG)"
            - "Test verifies valid spec.yaml was generated"
            - "Test verifies MOCK_EXIT_CODE is respected"
            - "Uses map-based table test pattern"
    - number: 5
      title: "User Story 3 - Exit Code Verification"
      purpose: "Verify all 6 documented exit codes (0-5) work correctly"
      story_reference: "US-003"
      independent_test: "Run tests for each exit code scenario and verify correct code is returned"
      tasks:
        - id: "T013"
          title: "Create exit code test file tests/e2e/exit_code_test.go"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: "US-003"
          file_path: "tests/e2e/exit_code_test.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "Test for exit code 0 (success)"
            - "Test for exit code 1 (validation failure)"
            - "Test for exit code 2 (retry limit exhausted)"
            - "Test for exit code 3 (invalid arguments)"
            - "Test for exit code 4 (missing dependency)"
            - "Test for exit code 5 (timeout)"
            - "Uses map-based table test pattern with all 6 cases"
    - number: 6
      title: "User Story 4 - Implement Command Flag Testing"
      purpose: "Test all implement command execution modes"
      story_reference: "US-004"
      independent_test: "Run implement with each execution mode flag and verify correct behavior"
      tasks:
        - id: "T014"
          title: "Create implement command E2E test tests/e2e/implement_test.go"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: "US-004"
          file_path: "tests/e2e/implement_test.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "Test --phases flag runs each phase in separate session"
            - "Test --phase N flag runs only specified phase"
            - "Test --from-phase N flag resumes from phase N"
            - "Test --tasks flag runs each task in separate session"
            - "Test --from-task T00N flag resumes from task T00N"
            - "Uses map-based table test pattern"
    - number: 7
      title: "User Story 5 - Run Command Coverage"
      purpose: "Test run command stage selection flags"
      story_reference: "US-005"
      independent_test: "Run with various flag combinations and verify correct stages execute"
      tasks:
        - id: "T015"
          title: "Create run command E2E test tests/e2e/run_test.go"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: "US-005"
          file_path: "tests/e2e/run_test.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "Test -s flag runs only specify stage"
            - "Test -p flag runs only plan stage (with existing spec)"
            - "Test -t flag runs only tasks stage (with existing plan)"
            - "Test -i flag runs only implement stage (with existing tasks)"
            - "Test -a flag runs all stages (same as -spti)"
            - "Test -spti flag combination"
            - "Test flag order independence (-itps same as -spti)"
            - "Uses map-based table test pattern"
    - number: 8
      title: "User Story 6 - Phase Ordering Property Tests"
      purpose: "Verify flag order does not affect execution order"
      story_reference: "US-006"
      independent_test: "Generate random flag permutations and verify same artifacts are created"
      tasks:
        - id: "T016"
          title: "Create phase ordering property test tests/e2e/ordering_test.go"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: "US-006"
          file_path: "tests/e2e/ordering_test.go"
          dependencies: ["T015"]
          acceptance_criteria:
            - "Test all 24 permutations of -s -p -t -i flags"
            - "Verify execution order is always specify→plan→tasks→implement"
            - "Test subset permutations (-sp, -ps, -pt, -tp, etc.)"
            - "Verify missing prerequisite errors are correct"
            - "Uses permutation iteration (not property testing library)"
    - number: 9
      title: "User Story 7 - Interactive Stage Mock Support"
      purpose: "Test optional workflow stages (clarify, checklist, analyze)"
      story_reference: "US-007"
      independent_test: "Run clarify, checklist, analyze and verify mock generates appropriate artifacts"
      tasks:
        - id: "T017"
          title: "Create optional stage E2E test tests/e2e/optional_stages_test.go"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: "US-007"
          file_path: "tests/e2e/optional_stages_test.go"
          dependencies: ["T005", "T006", "T007", "T009"]
          acceptance_criteria:
            - "Test clarify command updates spec.yaml"
            - "Test checklist command generates checklist.yaml"
            - "Test analyze command generates analysis.yaml"
            - "Uses map-based table test pattern"
    - number: 10
      title: "User Story 8 - Global Flag Testing"
      purpose: "Test global flags across commands"
      story_reference: "US-008"
      independent_test: "Run commands with global flags and verify they take effect"
      tasks:
        - id: "T018"
          title: "Create global flags E2E test tests/e2e/global_flags_test.go"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: "US-008"
          file_path: "tests/e2e/global_flags_test.go"
          dependencies: ["T012"]
          acceptance_criteria:
            - "Test --max-retries flag affects retry behavior"
            - "Test --agent flag switches between claude/opencode"
            - "Test --config flag uses custom config file"
            - "Test --skip-preflight flag skips preflight checks"
            - "Uses map-based table test pattern"
    - number: 11
      title: "User Story 9 - Error Scenario Coverage"
      purpose: "Test error scenarios with clear messages and exit codes"
      story_reference: "US-009"
      independent_test: "Trigger each error scenario and verify error message and exit code"
      tasks:
        - id: "T019"
          title: "Create error scenario E2E test tests/e2e/error_scenarios_test.go"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: "US-009"
          file_path: "tests/e2e/error_scenarios_test.go"
          dependencies: ["T013"]
          acceptance_criteria:
            - "Test missing tasks.yaml error for implement"
            - "Test invalid phase number error"
            - "Test missing agent binary error"
            - "Test invalid config YAML error"
            - "Verify error messages are clear and actionable"
            - "Uses map-based table test pattern"
    - number: 12
      title: "User Story 10 - Utility Command Testing"
      purpose: "Test utility commands (status, history, clean, view, ck)"
      story_reference: "US-010"
      independent_test: "Run each utility command and verify output/behavior"
      tasks:
        - id: "T020"
          title: "Create utility command E2E test tests/e2e/util_test.go"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: "US-010"
          file_path: "tests/e2e/util_test.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "Test status command shows spec state"
            - "Test history command shows recent executions"
            - "Test view command displays artifact contents"
            - "Test ck command validates YAML files"
            - "Test clean command removes artifacts"
            - "Uses map-based table test pattern"
    - number: 13
      title: "User Story 11 - Config, Admin, Worktree, and DAG Command Testing"
      purpose: "Complete 100% CLI command coverage"
      story_reference: "US-011"
      independent_test: "Run each command category and verify basic functionality"
      tasks:
        - id: "T021"
          title: "Create config command E2E test tests/e2e/config_test.go"
          status: "Pending"
          type: "test"
          parallel: true
          story_id: "US-011"
          file_path: "tests/e2e/config_test.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "Test init command creates config files"
            - "Test config show displays configuration"
            - "Test config set/get modifies values"
            - "Test config toggle switches boolean values"
            - "Test config keys lists known keys"
            - "Test config sync synchronizes configs"
            - "Test migrate command"
            - "Test doctor command with mock network status"
            - "Uses map-based table test pattern"
        - id: "T022"
          title: "Create admin command E2E test tests/e2e/admin_test.go"
          status: "Pending"
          type: "test"
          parallel: true
          story_id: "US-011"
          file_path: "tests/e2e/admin_test.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "Test commands check shows installation status"
            - "Test commands info displays command details"
            - "Test commands install installs commands"
            - "Test completion bash outputs bash completion"
            - "Test completion zsh outputs zsh completion"
            - "Test completion fish outputs fish completion"
            - "Test completion install installs completion"
            - "Test uninstall removes autospec"
            - "Uses map-based table test pattern"
        - id: "T023"
          title: "Create worktree command E2E test tests/e2e/worktree_test.go"
          status: "Pending"
          type: "test"
          parallel: true
          story_id: "US-011"
          file_path: "tests/e2e/worktree_test.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "Test worktree list shows worktrees"
            - "Test worktree create creates new worktree"
            - "Test worktree remove removes worktree"
            - "Test worktree prune cleans stale worktrees"
            - "Test worktree setup runs setup script"
            - "Test worktree gen-script generates setup script"
            - "Uses real worktrees in temp git repo"
            - "Uses map-based table test pattern"
        - id: "T024"
          title: "Create DAG command E2E test tests/e2e/dag_test.go"
          status: "Pending"
          type: "test"
          parallel: true
          story_id: "US-011"
          file_path: "tests/e2e/dag_test.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "Test dag validate checks task dependencies"
            - "Test dag status shows execution status"
            - "Test dag run executes tasks"
            - "Test dag resume continues execution"
            - "Test dag logs shows execution logs"
            - "Test dag reset clears execution state"
            - "Test dag watch monitors execution"
            - "Uses map-based table test pattern"
    - number: 14
      title: "Polish & Cross-Cutting Concerns"
      purpose: "Coverage audit, CI verification, and documentation"
      tasks:
        - id: "T025"
          title: "Create command coverage audit test tests/e2e/coverage_audit_test.go"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: null
          file_path: "tests/e2e/coverage_audit_test.go"
          dependencies: ["T021", "T022", "T023", "T024"]
          acceptance_criteria:
            - "Test enumerates all CLI commands via reflection/parsing"
            - "Test verifies each command has at least one E2E test"
            - "Reports coverage percentage and missing commands"
            - "Fails if coverage is below 100%"
        - id: "T026"
          title: "Verify E2E tests pass in CI with make test-e2e"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: null
          file_path: ".github/workflows/"
          dependencies: ["T025"]
          acceptance_criteria:
            - "make test-e2e passes locally"
            - "E2E tests complete in under 5 minutes"
            - "No flaky tests on 3 consecutive runs"
        - id: "T027"
          title: "Create manual testing plan .dev/tasks/102-e2e-mock-testing.md"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: ".dev/tasks/102-e2e-mock-testing.md"
          dependencies: ["T025"]
          acceptance_criteria:
            - "Manual test plan for E2E test infrastructure"
            - "Includes Report Summaries section for results"
            - "Covers safety verification manual checks"
        - id: "T028"
          title: "Update CHANGELOG.md with E2E test coverage feature"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "CHANGELOG.md"
          dependencies: ["T025"]
          acceptance_criteria:
            - "1-3 user-facing bullets summarizing the feature"
            - "Mentions mock-opencode.sh addition"
            - "Mentions 100% command coverage goal"
        - id: "T029"
          title: "Run make test && make fmt && make lint && make build"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: null
          file_path: "Makefile"
          dependencies: ["T028"]
          acceptance_criteria:
            - "make test exits 0"
            - "make fmt exits 0"
            - "make lint exits 0"
            - "make build exits 0"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-002"]
        - story_id: "US-002"
          depends_on: ["US-001"]
          blocks: []
        - story_id: "US-003"
          depends_on: []
          blocks: ["US-009"]
        - story_id: "US-004"
          depends_on: []
          blocks: []
        - story_id: "US-005"
          depends_on: []
          blocks: ["US-006"]
        - story_id: "US-006"
          depends_on: ["US-005"]
          blocks: []
        - story_id: "US-007"
          depends_on: []
          blocks: []
        - story_id: "US-008"
          depends_on: ["US-002"]
          blocks: []
        - story_id: "US-009"
          depends_on: ["US-003"]
          blocks: []
        - story_id: "US-010"
          depends_on: []
          blocks: []
        - story_id: "US-011"
          depends_on: []
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13]
        - phase: 3
          blocks: [4]
        - phase: 4
          blocks: []
        - phase: 5
          blocks: []
        - phase: 6
          blocks: []
        - phase: 7
          blocks: [8]
        - phase: 8
          blocks: []
        - phase: 9
          blocks: []
        - phase: 10
          blocks: []
        - phase: 11
          blocks: []
        - phase: 12
          blocks: []
        - phase: 13
          blocks: [14]
        - phase: 14
          blocks: []
parallel_execution:
    - phase: 1
      parallel_groups:
        - tasks: ["T002", "T003"]
          rationale: "Different mock scripts, no dependencies after T001"
    - phase: 2
      parallel_groups:
        - tasks: ["T005", "T006", "T007"]
          rationale: "Independent slash command additions to mock-claude.sh"
        - tasks: ["T009"]
          rationale: "Test data creation is independent of mock script changes"
    - phase: 13
      parallel_groups:
        - tasks: ["T021", "T022", "T023", "T024"]
          rationale: "Independent command categories with no dependencies between them"
    - phase: 14
      parallel_groups:
        - tasks: ["T027", "T028"]
          rationale: "Documentation tasks are independent of each other"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3, 4, 5]
        description: "Setup + Foundational + Safety + OpenCode + Exit Codes"
        validation: "Safety tests pass, OpenCode workflow works, all exit codes verified"
    incremental_delivery:
        - milestone: "Foundation Ready"
          phases: [1, 2]
          deliverable: "Mock scripts ready, E2EEnv extended, test fixtures in place"
        - milestone: "Safety Verified"
          phases: [1, 2, 3]
          deliverable: "Safety tests ensure no real API calls, environment isolated"
        - milestone: "Core Commands Tested"
          phases: [1, 2, 3, 4, 5, 6, 7]
          deliverable: "Run and implement commands have comprehensive flag coverage"
        - milestone: "Full Coverage"
          phases: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]
          deliverable: "100% CLI command coverage, CI passing, documentation complete"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec 0.9.0"
    created: "2026-01-16T18:47:26Z"
    artifact_type: "tasks"
