_meta:
  version: "1.0.0"
  generator: "autospec"
  generator_version: "1.25.4"
  created: "2025-12-14T20:35:09Z"
  artifact_type: "tasks"

tasks:
  branch: "011-yaml-config-migration"
  created: "2025-12-14"
  spec_path: "specs/011-yaml-config-migration/spec.yaml"
  plan_path: "specs/011-yaml-config-migration/plan.yaml"

summary:
  total_tasks: 28
  total_phases: 8
  parallel_opportunities: 12
  estimated_complexity: "medium"

phases:
  - number: 1
    title: "Setup"
    purpose: "Add new dependencies and create file structure for YAML configuration"
    tasks:
      - id: "T001"
        title: "Add koanf YAML parser dependency to go.mod"
        status: "Pending"
        type: "setup"
        parallel: false
        story_id: null
        file_path: "go.mod"
        dependencies: []
        acceptance_criteria:
          - "go.mod includes github.com/knadh/koanf/parsers/yaml v0.1.0"
          - "go mod tidy runs without errors"
          - "go build succeeds with new dependency"

  - number: 2
    title: "Foundational"
    purpose: "Core YAML configuration infrastructure that all user stories depend on"
    tasks:
      - id: "T002"
        title: "Create paths.go with XDG-compliant config path resolution"
        status: "Pending"
        type: "implementation"
        parallel: true
        story_id: null
        file_path: "internal/config/paths.go"
        dependencies: ["T001"]
        acceptance_criteria:
          - "UserConfigPath() returns ~/.config/autospec/config.yml (or XDG_CONFIG_HOME equivalent)"
          - "ProjectConfigPath() returns .autospec/config.yml relative to current directory"
          - "LegacyUserConfigPath() returns ~/.autospec/config.json for migration support"
          - "LegacyProjectConfigPath() returns .autospec/config.json for migration support"
          - "Cross-platform support using os.UserConfigDir()"

      - id: "T003"
        title: "Create paths_test.go with path resolution tests"
        status: "Pending"
        type: "test"
        parallel: true
        story_id: null
        file_path: "internal/config/paths_test.go"
        dependencies: ["T001"]
        acceptance_criteria:
          - "Test UserConfigPath returns correct path on Linux (~/.config/autospec/config.yml)"
          - "Test XDG_CONFIG_HOME override is respected"
          - "Test ProjectConfigPath returns .autospec/config.yml"
          - "Test legacy path functions return correct JSON paths"

      - id: "T004"
        title: "Create validate.go with YAML validation and error reporting"
        status: "Pending"
        type: "implementation"
        parallel: true
        story_id: null
        file_path: "internal/config/validate.go"
        dependencies: ["T001"]
        acceptance_criteria:
          - "ValidateYAMLSyntax() checks YAML syntax and returns errors with line numbers"
          - "ValidateConfigSchema() validates config values against expected types"
          - "Error messages include file path, line number, and problem description"
          - "Empty files return gracefully with no error"
          - "Unknown keys are ignored (warn in debug mode)"

      - id: "T005"
        title: "Create validate_test.go with validation error tests"
        status: "Pending"
        type: "test"
        parallel: true
        story_id: null
        file_path: "internal/config/validate_test.go"
        dependencies: ["T001"]
        acceptance_criteria:
          - "Test valid YAML syntax passes validation"
          - "Test invalid YAML syntax returns error with line number"
          - "Test invalid config values (wrong types) return clear errors"
          - "Test empty file handling"
          - "Test unknown keys are ignored without error"

  - number: 3
    title: "User Story 1 - User-level configuration initialization"
    purpose: "Allow autospec init to create user-level config at ~/.config/autospec/config.yml"
    story_reference: "US-001"
    independent_test: "Run autospec init on a fresh system with no existing config files and verify ~/.config/autospec/config.yml is created"
    tasks:
      - id: "T006"
        title: "Update config.go Load() to use YAML parser and new user config path"
        status: "Pending"
        type: "implementation"
        parallel: false
        story_id: "US-001"
        file_path: "internal/config/config.go"
        dependencies: ["T002", "T003", "T004", "T005"]
        acceptance_criteria:
          - "Load() reads from ~/.config/autospec/config.yml instead of ~/.autospec/config.json"
          - "Uses koanf YAML parser for config loading"
          - "Maintains all existing config fields"
          - "Environment variable overrides still work (AUTOSPEC_*)"

      - id: "T007"
        title: "Update config_test.go for YAML loading"
        status: "Pending"
        type: "test"
        parallel: false
        story_id: "US-001"
        file_path: "internal/config/config_test.go"
        dependencies: ["T006"]
        acceptance_criteria:
          - "Test YAML config is loaded correctly"
          - "Test missing config file returns defaults"
          - "Test environment variable overrides"
          - "Test all config fields are correctly parsed"

      - id: "T008"
        title: "Update init.go to create user-level YAML config by default"
        status: "Pending"
        type: "implementation"
        parallel: false
        story_id: "US-001"
        file_path: "internal/cli/init.go"
        dependencies: ["T006"]
        acceptance_criteria:
          - "autospec init creates config at ~/.config/autospec/config.yml"
          - "Creates parent directories if they don't exist"
          - "Preserves existing config if present (notifies user)"
          - "Writes default config values in YAML format"
          - "Help text updated to reflect user-level default behavior"

      - id: "T009"
        title: "Create or update init_test.go for user-level init behavior"
        status: "Pending"
        type: "test"
        parallel: false
        story_id: "US-001"
        file_path: "internal/cli/init_test.go"
        dependencies: ["T008"]
        acceptance_criteria:
          - "Test init creates user config at correct path"
          - "Test init creates parent directories"
          - "Test init preserves existing config"
          - "Test init notifies when config already exists"

  - number: 4
    title: "User Story 2 - Project-level configuration creation"
    purpose: "Provide a way to create project-level config at .autospec/config.yml"
    story_reference: "US-002"
    independent_test: "Run autospec init --project in a project directory and verify .autospec/config.yml is created"
    tasks:
      - id: "T010"
        title: "Add --project flag to init command for project-level config"
        status: "Pending"
        type: "implementation"
        parallel: false
        story_id: "US-002"
        file_path: "internal/cli/init.go"
        dependencies: ["T008"]
        acceptance_criteria:
          - "autospec init --project creates config at .autospec/config.yml"
          - "Creates .autospec directory if it doesn't exist"
          - "Preserves existing project config if present (notifies user)"
          - "Help text explains difference between user and project config"
          - "-p short flag available for --project"

      - id: "T011"
        title: "Update init_test.go with project-level init tests"
        status: "Pending"
        type: "test"
        parallel: false
        story_id: "US-002"
        file_path: "internal/cli/init_test.go"
        dependencies: ["T010"]
        acceptance_criteria:
          - "Test init --project creates .autospec/config.yml"
          - "Test init --project creates .autospec directory"
          - "Test init --project preserves existing config"
          - "Test init --project notifies when config already exists"

  - number: 5
    title: "User Story 3 - Configuration precedence"
    purpose: "Implement project-level config takes precedence over user-level"
    story_reference: "US-003"
    independent_test: "Create both config files with different timeout values and verify project-level value is used"
    tasks:
      - id: "T012"
        title: "Update config.go Load() to support two-tier YAML config merging"
        status: "Pending"
        type: "implementation"
        parallel: false
        story_id: "US-003"
        file_path: "internal/config/config.go"
        dependencies: ["T006"]
        acceptance_criteria:
          - "Load order: defaults < user YAML < project YAML < env vars"
          - "Project-level config overrides user-level for same keys"
          - "User-level values used when project doesn't specify"
          - "Missing config files handled gracefully (use next level)"

      - id: "T013"
        title: "Add precedence tests to config_test.go"
        status: "Pending"
        type: "test"
        parallel: false
        story_id: "US-003"
        file_path: "internal/config/config_test.go"
        dependencies: ["T012"]
        acceptance_criteria:
          - "Test project timeout overrides user timeout"
          - "Test user value used when project doesn't specify"
          - "Test env var overrides both config files"
          - "Test partial config override (some keys from user, some from project)"
          - "Test missing user config with present project config"
          - "Test missing project config with present user config"

  - number: 6
    title: "User Story 4 - YAML configuration validation"
    purpose: "Validate YAML config files and provide clear error messages"
    story_reference: "US-004"
    independent_test: "Create an invalid YAML config file and verify autospec reports the error clearly"
    tasks:
      - id: "T014"
        title: "Integrate validate.go validation into config.go Load()"
        status: "Pending"
        type: "implementation"
        parallel: false
        story_id: "US-004"
        file_path: "internal/config/config.go"
        dependencies: ["T012"]
        acceptance_criteria:
          - "Invalid YAML syntax produces error with file path and line number"
          - "Invalid config values produce clear error messages"
          - "Validation runs on both user and project config files"
          - "Empty files do not cause errors (use defaults)"
          - "Application continues with defaults on missing files"

      - id: "T015"
        title: "Add validation integration tests to config_test.go"
        status: "Pending"
        type: "test"
        parallel: false
        story_id: "US-004"
        file_path: "internal/config/config_test.go"
        dependencies: ["T014"]
        acceptance_criteria:
          - "Test invalid YAML syntax error includes line number"
          - "Test invalid value type error is clear"
          - "Test empty file loads defaults without error"
          - "Test permission error produces clear message"

  - number: 7
    title: "User Story 5 - Migration from JSON to YAML"
    purpose: "Allow existing users to migrate JSON config to YAML format"
    story_reference: "US-005"
    independent_test: "Create a JSON config file and run autospec config migrate to convert it to YAML"
    tasks:
      - id: "T016"
        title: "Create migrate.go with JSON to YAML conversion logic"
        status: "Pending"
        type: "implementation"
        parallel: false
        story_id: "US-005"
        file_path: "internal/config/migrate.go"
        dependencies: ["T002"]
        acceptance_criteria:
          - "MigrateJSON() reads JSON config and converts to YAML format"
          - "MigrateUserConfig() migrates ~/.autospec/config.json to ~/.config/autospec/config.yml"
          - "MigrateProjectConfig() migrates .autospec/config.json to .autospec/config.yml"
          - "Preserves all config values during migration"
          - "Supports --dry-run mode to preview changes"

      - id: "T017"
        title: "Create migrate_test.go with migration tests"
        status: "Pending"
        type: "test"
        parallel: false
        story_id: "US-005"
        file_path: "internal/config/migrate_test.go"
        dependencies: ["T016"]
        acceptance_criteria:
          - "Test JSON config is correctly converted to YAML"
          - "Test all config fields are preserved"
          - "Test dry-run mode shows preview without changes"
          - "Test migration handles missing JSON file gracefully"
          - "Test migration handles invalid JSON file"

      - id: "T018"
        title: "Implement autospec config migrate command"
        status: "Pending"
        type: "implementation"
        parallel: false
        story_id: "US-005"
        file_path: "internal/cli/config.go"
        dependencies: ["T016"]
        acceptance_criteria:
          - "autospec config migrate converts JSON to YAML"
          - "--user flag migrates user-level config only"
          - "--project flag migrates project-level config only"
          - "--dry-run flag shows what would be migrated"
          - "Returns exit code 1 if no JSON config found"
          - "Returns exit code 2 if migration fails"

      - id: "T019"
        title: "Add JSON detection warning to config loading"
        status: "Pending"
        type: "implementation"
        parallel: false
        story_id: "US-005"
        file_path: "internal/config/config.go"
        dependencies: ["T018"]
        acceptance_criteria:
          - "When JSON config detected, print deprecation warning"
          - "Warning suggests running autospec config migrate"
          - "Warning includes path to detected JSON file"
          - "Both JSON and YAML exist: YAML takes precedence, warn about JSON being ignored"

      - id: "T020"
        title: "Add config migrate tests to config_test.go"
        status: "Pending"
        type: "test"
        parallel: false
        story_id: "US-005"
        file_path: "internal/cli/config_test.go"
        dependencies: ["T018", "T019"]
        acceptance_criteria:
          - "Test config migrate command converts JSON to YAML"
          - "Test --dry-run shows preview"
          - "Test error when no JSON config found"
          - "Test JSON detection warning appears on load"

  - number: 8
    title: "Polish & Cross-Cutting Concerns"
    purpose: "Config show command and documentation updates"
    tasks:
      - id: "T021"
        title: "Implement autospec config show command"
        status: "Pending"
        type: "implementation"
        parallel: true
        story_id: null
        file_path: "internal/cli/config.go"
        dependencies: ["T014"]
        acceptance_criteria:
          - "autospec config show displays effective config values"
          - "Shows source of each value (default/user/project/env)"
          - "--yaml flag outputs YAML format (default)"
          - "--json flag outputs JSON format"
          - "Handles missing config files gracefully"

      - id: "T022"
        title: "Add config show tests to config_test.go"
        status: "Pending"
        type: "test"
        parallel: true
        story_id: null
        file_path: "internal/cli/config_test.go"
        dependencies: ["T021"]
        acceptance_criteria:
          - "Test config show displays all values"
          - "Test config show shows correct sources"
          - "Test --yaml output format"
          - "Test --json output format"

      - id: "T023"
        title: "Update CLAUDE.md configuration documentation"
        status: "Pending"
        type: "documentation"
        parallel: true
        story_id: null
        file_path: "CLAUDE.md"
        dependencies: ["T014", "T018", "T021"]
        acceptance_criteria:
          - "Configuration section updated with new YAML paths"
          - "Precedence order documented (env > project > user > defaults)"
          - "New config locations documented (~/.config/autospec/config.yml)"
          - "Migration command documented"
          - "Config show command documented"

      - id: "T024"
        title: "Update README.md configuration documentation"
        status: "Pending"
        type: "documentation"
        parallel: true
        story_id: null
        file_path: "README.md"
        dependencies: ["T014", "T018", "T021"]
        acceptance_criteria:
          - "Configuration section updated with YAML format"
          - "New config paths documented"
          - "Migration guide for existing users"
          - "Quick start updated for new init behavior"

      - id: "T025"
        title: "Update CLI help text for init command"
        status: "Pending"
        type: "documentation"
        parallel: true
        story_id: null
        file_path: "internal/cli/init.go"
        dependencies: ["T010"]
        acceptance_criteria:
          - "Help text explains user-level config is default"
          - "Help text explains --project flag for project config"
          - "Examples show both user and project config creation"

      - id: "T026"
        title: "Update CLI help text for config commands"
        status: "Pending"
        type: "documentation"
        parallel: true
        story_id: null
        file_path: "internal/cli/config.go"
        dependencies: ["T018", "T021"]
        acceptance_criteria:
          - "Help text explains config show command"
          - "Help text explains config migrate command"
          - "Examples show common use cases"

      - id: "T027"
        title: "Run all tests and verify no regressions"
        status: "Pending"
        type: "test"
        parallel: false
        story_id: null
        file_path: "internal/config/"
        dependencies: ["T020", "T022"]
        acceptance_criteria:
          - "make test passes"
          - "go test -v -race -cover ./... passes"
          - "No test failures"
          - "Coverage maintained or improved"

      - id: "T028"
        title: "Build and verify binary works end-to-end"
        status: "Pending"
        type: "test"
        parallel: false
        story_id: null
        file_path: "cmd/autospec/main.go"
        dependencies: ["T027"]
        acceptance_criteria:
          - "make build succeeds"
          - "autospec init creates user config"
          - "autospec init --project creates project config"
          - "autospec config show works"
          - "autospec config migrate works"
          - "Configuration precedence works correctly"

dependencies:
  user_story_order:
    - story_id: "US-001"
      depends_on: []
      blocks: ["US-002", "US-003"]
    - story_id: "US-002"
      depends_on: ["US-001"]
      blocks: []
    - story_id: "US-003"
      depends_on: ["US-001"]
      blocks: ["US-004"]
    - story_id: "US-004"
      depends_on: ["US-003"]
      blocks: ["US-005"]
    - story_id: "US-005"
      depends_on: ["US-004"]
      blocks: []

  phase_order:
    - phase: 1
      blocks: [2]
    - phase: 2
      blocks: [3, 4, 5, 6, 7]
    - phase: 3
      blocks: [4, 5]
    - phase: 4
      blocks: []
    - phase: 5
      blocks: [6]
    - phase: 6
      blocks: [7]
    - phase: 7
      blocks: [8]

parallel_execution:
  - phase: 2
    parallel_groups:
      - tasks: ["T002", "T003", "T004", "T005"]
        rationale: "paths.go and validate.go are independent modules with separate tests"
  - phase: 8
    parallel_groups:
      - tasks: ["T021", "T022"]
        rationale: "Config show command and its tests can be developed together"
      - tasks: ["T023", "T024", "T025", "T026"]
        rationale: "Documentation updates are independent of each other"

implementation_strategy:
  mvp_scope:
    phases: [1, 2, 3]
    description: "Setup + Foundational + User-level config initialization"
    validation: "autospec init creates user config at ~/.config/autospec/config.yml with YAML format"
  incremental_delivery:
    - milestone: "Foundation Ready"
      phases: [1, 2]
      deliverable: "YAML parsing and validation infrastructure in place"
    - milestone: "User Config Complete"
      phases: [1, 2, 3]
      deliverable: "Users can initialize and use user-level YAML config"
    - milestone: "Full Config System"
      phases: [1, 2, 3, 4, 5]
      deliverable: "Both user and project configs work with correct precedence"
    - milestone: "Migration Ready"
      phases: [1, 2, 3, 4, 5, 6, 7]
      deliverable: "Existing JSON users can migrate to YAML"
    - milestone: "Release Ready"
      phases: [1, 2, 3, 4, 5, 6, 7, 8]
      deliverable: "Complete feature with documentation and polish"
