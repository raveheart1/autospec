_meta:
  version: "1.0.0"
  generator: "autospec"
  generator_version: "dev"
  created: "2025-12-14T12:30:00Z"
  artifact_type: "plan"

plan:
  branch: "010-cli-help-examples"
  created: "2025-12-14"
  spec_path: "specs/010-cli-help-examples/spec.yaml"

summary: |
  This implementation enhances the autospec CLI with comprehensive usage examples,
  actionable error messages, and dry-run capabilities. The core approach is to
  extend existing Cobra command definitions with an Examples field, create a
  centralized error formatting helper that categorizes errors and provides
  remediation steps, and implement a dry-run mode that previews actions without
  execution.

  The implementation leverages Cobra's built-in Example field for help text
  consistency, introduces an errors package for structured error handling with
  categories and remediation hints, and adds a --dry-run flag to commands that
  create files or invoke external tools. All changes maintain backward
  compatibility with existing command interfaces.

technical_context:
  language: "Go"
  framework: "Cobra CLI (v1.10.1)"
  primary_dependencies:
    - name: "github.com/spf13/cobra"
      version: "v1.10.1"
      purpose: "CLI framework with built-in Example field support"
    - name: "github.com/fatih/color"
      version: "v1.16.0"
      purpose: "Terminal colors for error formatting (optional, graceful fallback)"
  storage: "None"
  testing:
    framework: "Go testing package"
    approach: "Unit tests for error formatting, integration tests for help output validation"
  target_platform: "Linux, macOS, Windows"
  project_type: "cli"
  performance_goals: "Dry-run completes in under 1 second; no performance regression on help display"
  constraints:
    - "Must maintain backward compatibility with existing command interfaces"
    - "Help text must fit in 80-column terminal"
    - "Error message changes must not break existing scripts or automation"
    - "Dry-run must not require changes to external tools (Claude CLI)"
  scale_scope: "Single binary, 15+ commands, local execution"

constitution_check:
  constitution_path: ".specify/memory/constitution.md"
  gates:
    - name: "Test-First Development"
      status: "PASS"
      notes: "Will write tests for error formatting and help output before implementation"
    - name: "CLI Interface"
      status: "PASS"
      notes: "Changes enhance CLI output; text in/out protocol maintained"
    - name: "Validation-First"
      status: "PASS"
      notes: "Dry-run validates inputs and shows planned actions without execution"

research_findings:
  decisions:
    - topic: "Help examples location"
      decision: "Use Cobra's built-in Example field in command definitions"
      rationale: "Native Cobra support ensures consistent formatting and automatic inclusion in --help output"
      alternatives_considered:
        - "External markdown files parsed at runtime"
        - "Separate examples subcommand"
        - "Generated documentation from tests"

    - topic: "Error message formatting"
      decision: "Create internal/errors package with structured error types"
      rationale: "Centralized error handling ensures consistency and allows categorization"
      alternatives_considered:
        - "Inline error strings with consistent prefixes"
        - "Error wrapping with context only"

    - topic: "Dry-run implementation"
      decision: "Implement at command level with DryRun field in workflow config"
      rationale: "Command-level control allows per-command customization without modifying workflow internals"
      alternatives_considered:
        - "Global interceptor that blocks all I/O"
        - "Mock filesystem implementation"

    - topic: "Color support in errors"
      decision: "Use fatih/color with automatic terminal detection"
      rationale: "Graceful fallback when colors unavailable; widely used in Go CLIs"
      alternatives_considered:
        - "ANSI escape codes directly"
        - "No colors (plain text only)"

data_model:
  entities:
    - name: "CLIError"
      description: "Structured error with category and remediation guidance"
      fields:
        - name: "Category"
          type: "ErrorCategory (enum)"
          description: "Type of error: Argument, Configuration, Prerequisite, Runtime"
          constraints: "Must be one of defined categories"
        - name: "Message"
          type: "string"
          description: "Human-readable description of what went wrong"
          constraints: "Non-empty, no jargon"
        - name: "Remediation"
          type: "[]string"
          description: "List of actionable steps to resolve the error"
          constraints: "At least one step"
        - name: "Usage"
          type: "string"
          description: "Correct command syntax if applicable"
          constraints: "Optional, present for argument errors"
      relationships:
        - target: "Command"
          type: "many-to-one"
          description: "Errors are generated by commands"

    - name: "DryRunResult"
      description: "Output from dry-run execution showing planned actions"
      fields:
        - name: "Actions"
          type: "[]PlannedAction"
          description: "List of actions that would be taken"
          constraints: "Non-empty for commands with side effects"
        - name: "FilesToCreate"
          type: "[]string"
          description: "Paths of files that would be created"
          constraints: "Absolute or relative paths"
        - name: "CommandsToRun"
          type: "[]string"
          description: "External commands that would be executed"
          constraints: "Full command strings"
      relationships:
        - target: "Command"
          type: "one-to-one"
          description: "Each dry-run produces one result"

api_contracts:
  endpoints: []

project_structure:
  documentation:
    - path: "CLAUDE.md"
      description: "Update CLI examples section with new --dry-run documentation"
  source_code:
    - path: "internal/cli/*.go"
      description: "Add Example field to all command definitions"
    - path: "internal/errors/"
      description: "New package for structured error types and formatting"
    - path: "internal/errors/errors.go"
      description: "CLIError type, categories, and formatting functions"
    - path: "internal/errors/messages.go"
      description: "Common error message templates"
    - path: "internal/workflow/dryrun.go"
      description: "Dry-run execution logic"
  tests:
    - path: "internal/errors/*_test.go"
      description: "Unit tests for error formatting and categories"
    - path: "internal/cli/*_test.go"
      description: "Tests for help output containing examples"
    - path: "internal/workflow/dryrun_test.go"
      description: "Tests for dry-run execution"

implementation_phases:
  - phase: 1
    name: "Help Examples"
    goal: "Add usage examples to all command help output"
    deliverables:
      - "Add Example field to all 15+ command definitions in internal/cli/"
      - "Ensure examples demonstrate common use cases and option combinations"
      - "Verify 80-column terminal compatibility"
      - "Add tests validating examples presence in help output"

  - phase: 2
    name: "Error Message Infrastructure"
    goal: "Create structured error handling with categories and remediation"
    dependencies:
      - "None"
    deliverables:
      - "Create internal/errors package with CLIError type"
      - "Define error categories (Argument, Configuration, Prerequisite, Runtime)"
      - "Implement FormatError function with colored output"
      - "Create error message templates for common scenarios"
      - "Add unit tests for error formatting"

  - phase: 3
    name: "Error Message Integration"
    goal: "Update all commands to use structured errors"
    dependencies:
      - "Phase 2"
    deliverables:
      - "Replace inline error strings with CLIError usage"
      - "Add remediation hints to all error paths"
      - "Update argument validation errors to show correct usage"
      - "Add tests for error output format"

  - phase: 4
    name: "Dry-Run Implementation"
    goal: "Add --dry-run flag to commands with side effects"
    dependencies:
      - "None"
    deliverables:
      - "Add DryRun field to config and workflow"
      - "Implement dry-run logic in workflow executor"
      - "Add --dry-run flag to: specify, plan, tasks, implement, run, all, workflow"
      - "Display [DRY RUN] prefix in output"
      - "Show planned actions without execution"
      - "Add tests for dry-run behavior"

  - phase: 5
    name: "Documentation and Polish"
    goal: "Update documentation and ensure consistency"
    dependencies:
      - "Phase 1"
      - "Phase 3"
      - "Phase 4"
    deliverables:
      - "Update CLAUDE.md with new flags and examples"
      - "Verify all help text fits 80 columns"
      - "Run full test suite and fix any failures"
      - "Manual testing of user scenarios from spec"

risks:
  - risk: "Example text makes help output too long"
    likelihood: "medium"
    impact: "low"
    mitigation: "Limit to 2-3 examples per command; use concise descriptions"

  - risk: "Color output causes issues in some terminals"
    likelihood: "low"
    impact: "low"
    mitigation: "Use fatih/color which auto-detects terminal support"

  - risk: "Dry-run cannot accurately preview Claude CLI execution"
    likelihood: "medium"
    impact: "medium"
    mitigation: "Show command that would be run rather than predicting output"

  - risk: "Error message changes break automation parsing"
    likelihood: "low"
    impact: "medium"
    mitigation: "Maintain exit codes; add --json flag for machine-parseable errors in future"

open_questions:
  - question: "Should dry-run output be formatted as YAML for machine parsing?"
    context: "Automation scripts may want to parse dry-run output"
    proposed_resolution: "Start with human-readable format; add --json flag if needed later"

  - question: "Should error colors be customizable?"
    context: "Some users may prefer different color schemes"
    proposed_resolution: "Use sensible defaults; defer customization to future enhancement"
