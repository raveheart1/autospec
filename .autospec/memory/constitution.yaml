constitution:
  project_name: "autospec"
  version: "1.1.0"
  ratified: "2026-01-16"
  last_amended: "2026-01-16"

preamble: |
  autospec is a Go CLI that orchestrates AI-driven specification workflows.
  These principles ensure code quality, maintainability, and reliable execution
  through test-driven development and idiomatic Go practices.

principles:
  - name: "Test-First Development"
    id: "PRIN-001"
    category: "quality"
    priority: "NON-NEGOTIABLE"
    description: "Tests written before implementation. Tests define behavior."
    rationale: "Ensures code quality and prevents regressions"
    enforcement:
      - mechanism: "CI pipeline"
        description: "Build fails if tests fail"
    exceptions:
      - "Prototype/spike code explicitly marked as such"

  - name: "Idiomatic Go"
    id: "PRIN-002"
    category: "quality"
    priority: "MUST"
    description: "Follow Go community conventions. See 'Go Idioms' section."
    rationale: "Consistent code is easier to review and maintain"
    enforcement:
      - mechanism: "Code review and linting"
        description: "golangci-lint + reviewer verification"
    exceptions: []

  - name: "Performance Standards"
    id: "PRIN-003"
    category: "quality"
    priority: "MUST"
    description: "Validation <10ms, config <100ms, user ops <1s."
    rationale: "Maintains responsive user experience"
    enforcement:
      - mechanism: "Benchmark tests"
        description: "Automated performance regression tests"
    exceptions: []

  - name: "Idempotent Operations"
    id: "PRIN-004"
    category: "architecture"
    priority: "MUST"
    description: "Operations are idempotent with configurable retry limits."
    rationale: "Enables reliable operations and recovery"
    enforcement:
      - mechanism: "Code review"
        description: "Reviewers check for idempotent patterns"
    exceptions:
      - "One-time initialization operations"

  - name: "Validation-First Workflow"
    id: "PRIN-005"
    category: "process"
    priority: "MUST"
    description: "Validate transitions before proceeding through stages."
    rationale: "Prevents invalid state propagation"
    enforcement:
      - mechanism: "Runtime validation"
        description: "Workflow engine validates transitions"
    exceptions: []

  - name: "Command Template Independence"
    id: "PRIN-006"
    category: "architecture"
    priority: "NON-NEGOTIABLE"
    description: "Templates are project-agnostic. No tool-specific references."
    rationale: "Ensures templates work across different environments"
    enforcement:
      - mechanism: "Code review"
        description: "Reviewers verify template portability"
    exceptions: []

  - name: "Actionable Errors"
    id: "PRIN-007"
    category: "ux"
    priority: "MUST"
    description: "Errors include context, expected vs actual, and fix hints."
    rationale: "Fail fast, fail clearly, provide actionable guidance"
    enforcement:
      - mechanism: "Code review"
        description: "Reviewers verify error messages include remediation"
    exceptions: []

  - name: "Schema-Driven Artifacts"
    id: "PRIN-008"
    category: "architecture"
    priority: "MUST"
    description: "All YAML artifacts validated against schemas before proceeding."
    rationale: "Catches malformed output early, enables programmatic tooling"
    enforcement:
      - mechanism: "Runtime validation"
        description: "autospec artifact validates before workflow continues"
    exceptions: []

sections:
  - name: "Code Quality"
    content: |
      All code must pass: make fmt && make lint && make test && make build
      E2E tests must also pass: go test -tags=e2e ./tests/e2e/...
      E2E tests should be comprehensive, testing real binary commands for any newly added CLI functionality.
      Use golangci-lint for static analysis.
      Run tests with -race flag for race detection.
      No warnings allowed in production builds.

  - name: "Go Idioms"
    content: |
      Error handling: Wrap with context using fmt.Errorf("doing X: %w", err).
      Table tests: Use map[string]struct{} with t.Run and t.Parallel().
      Functions: Keep under 40 lines, extract helpers as needed.
      Interfaces: Accept interfaces, return concrete types.
      Stdlib first: Use standard library before external packages.
      Context: First parameter when needed for cancellation.
      Modularity: Reuse existing functions, no circular dependencies.

  - name: "Naming Conventions"
    content: |
      Package names: short, lowercase, no underscores.
      Interfaces: -er suffix for single-method (Validator, Reader).
      Avoid stutter: config.Config not config.ConfigConfig.
      Exported: CamelCase, unexported: camelCase.

  - name: "Documentation"
    content: |
      Document all exported types, functions, and constants.
      Comment complex algorithms and performance-critical code.
      Architecture decisions recorded in docs/internal/.

  - name: "Test Safety"
    content: |
      Tests must NEVER modify real project files or directories.
      Always use t.TempDir() or explicit temp directory isolation.
      Tests operating on cwd must use os.Chdir to temp dirs with cleanup.
      The .autospec/ directory must never be touched by unit tests.

governance:
  amendment_process:
    - step: 1
      action: "Propose change via pull request"
      requirements: "Include rationale and impact assessment"
    - step: 2
      action: "Review period"
      requirements: "Minimum 48 hours for team review"
    - step: 3
      action: "Approval"
      requirements: "Requires maintainer approval"
    - step: 4
      action: "Merge and version bump"
      requirements: "Update version and last_amended date"

  versioning_policy: |
    Constitution versions follow semantic versioning.
    MAJOR: Changes that invalidate existing compliant code.
    MINOR: New principles or expanded guidance.
    PATCH: Clarifications without behavioral change.

  compliance_review:
    frequency: "quarterly"
    process: "Review all principles for relevance and enforcement effectiveness"

  rules:
    - "Changes require review by at least one maintainer"
    - "Breaking changes require explicit team discussion"
    - "Emergency changes may bypass review with post-hoc documentation"

sync_impact:
  version_change: "1.0.0 -> 1.1.0"
  modified_principles: []
  added_sections:
    - "Code Quality"
    - "Go Idioms"
    - "Naming Conventions"
    - "Documentation"
    - "Test Safety"
  removed_sections: []
  templates_requiring_updates: []
  follow_up_todos: []

_meta:
  version: "1.1.0"
  generator: "autospec"
  generator_version: "0.9.0"
  created: "2026-01-16T17:13:33Z"
  artifact_type: "constitution"
